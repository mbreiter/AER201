MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00001 ;*******************************************************************************
                      00002 ;
                      00003 ;    Filename: main.asm
                      00004 ;    Date: 2 Feb 2017
                      00005 ;    File Version: 1.0
                      00006 ;    Author: Matthew Reiter
                      00007 ;    Course: AER201
                      00008 ;    Description: botL - a pastic bottle sorting machine
                      00009  
                      00010 ;*******************************************************************************
                      00011 ; configuration settings
                      00012 ;*******************************************************************************
                      00013 
Warning[205]: Found directive in column 1. (list)
                      00014 list    P=18F4620, F=INHX32, C=160, N=80, ST=OFF, MM=OFF, R=DEC
                      00015 #include <p18f4620.inc>
                      00001         LIST
                      00002 
                      00003 ;==========================================================================
                      00004 ; Build date : Jan 30 2017
                      00005 ;  MPASM PIC18F4620 processor include
                      00006 ; 
                      00007 ;  (c) Copyright 1999-2017 Microchip Technology, All rights reserved
                      00008 ;==========================================================================
                      00009 
                      01440         LIST
                      00016 #include <lcd.inc>
  0000                00001     extern      InitLCD,WrtLCD,ClrLCD,ClkLCD,WR_INS,WR_DATA,LCD_L1,LCD_L2,delay5ms,Shift
                      00002 
                      00003 
                      00004 
                      00005 
                      00006 
                      00007 
                      00017 #include <rtc.inc>
Warning[205]: Found directive in column 1. (extern)
  0000                00001 extern  write_rtc,read_rtc,rtc_convert,i2c_common_setup, regaddress, databyte, datachar,tens_digit,ones_digit
                      00002 
Warning[205]: Found directive in column 1. (variable)
  0000                00003 variable _loopknt=0
                      00004 
                      00005 rtc_resetAll macro
                      00006 
                      00007     clrf    databyte
                      00008     movlw   6
                      00009     movwf   regaddress ;start at 6 and go down, and set all to 0
                      00010 
                      00011     del_loop#v(_loopknt)
                      00012     call    write_rtc
                      00013     decfsz  regaddress
                      00014     bra     del_loop#v(_loopknt)
                      00015     call    write_rtc ;sets registers 0-6 to zero
                      00016     _loopknt set _loopknt+1
Warning[205]: Found directive in column 1. (endm)
                      00017 endm
                      00018 
                      00019 rtc_set macro addliteral,datliteral
                      00020     movlw   addliteral
                      00021     movwf   regaddress
                      00022     movlw   datliteral
                      00023     movwf   databyte
                      00024     call    write_rtc
Warning[205]: Found directive in column 1. (endm)
                      00025 endm
                      00026 
                      00027 rtc_read macro addliteral
                      00028     movlw   addliteral
                      00029     movwf   regaddress
                      00030     call    read_rtc
                      00031     movff   datachar, WREG
                      00032     call    rtc_convert
Warning[205]: Found directive in column 1. (endm)
                      00033 endm
                      00018 #include <colour.inc>
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  0000                00001     extern      i2c_common_setup, regaddress, databyte, datachar, READ_COLOUR_I2C, WRITE_COLOUR_I2C, WR_DATA, delay5ms
                      00002 
                      00003 ;    #define TCS34725_ADDRESS          (0x29)
                      00004 ;
                      00005 ;    #define TCS34725_COMMAND_BIT      (0x80)
                      00006 ;
                      00007 ;    #define TCS34725_ENABLE           (0x00)
                      00008 ;    #define TCS34725_ENABLE_AIEN      (0x10)    /* RGBC Interrupt Enable */
                      00009 ;    #define TCS34725_ENABLE_WEN       (0x08)    /* Wait enable - Writing 1 activates the wait timer */
                      00010 ;    #define TCS34725_ENABLE_AEN       (0x02)    /* RGBC Enable - Writing 1 actives the ADC, 0 disables it */
                      00011 ;    #define TCS34725_ENABLE_PON       (0x01)    /* Power on - Writing 1 activates the internal oscillator, 0 disables it */
                      00012 ;    #define TCS34725_ATIME            (0x01)    /* Integration time */
                      00013 ;    #define TCS34725_WTIME            (0x03)    /* Wait time (if TCS34725_ENABLE_WEN is asserted) */
                      00014 ;    #define TCS34725_WTIME_2_4MS      (0xFF)    /* WLONG0 = 2.4ms   WLONG1 = 0.029s */
                      00015 ;    #define TCS34725_WTIME_204MS      (0xAB)    /* WLONG0 = 204ms   WLONG1 = 2.45s  */
                      00016 ;    #define TCS34725_WTIME_614MS      (0x00)    /* WLONG0 = 614ms   WLONG1 = 7.4s   */
                      00017 ;    #define TCS34725_AILTL            (0x04)    /* Clear channel lower interrupt threshold */
                      00018 ;    #define TCS34725_AILTH            (0x05)
                      00019 ;    #define TCS34725_AIHTL            (0x06)    /* Clear channel upper interrupt threshold */
                      00020 ;    #define TCS34725_AIHTH            (0x07)
                      00021 ;    #define TCS34725_PERS             (0x0C)    /* Persistence register - basic SW filtering mechanism for interrupts */
                      00022 ;    #define TCS34725_PERS_NONE        (0b0000)  /* Every RGBC cycle generates an interrupt                                */
                      00023 ;    #define TCS34725_PERS_1_CYCLE     (0b0001)  /* 1 clean channel value outside threshold range generates an interrupt   */
                      00024 ;    #define TCS34725_PERS_2_CYCLE     (0b0010)  /* 2 clean channel values outside threshold range generates an interrupt  */
                      00025 ;    #define TCS34725_PERS_3_CYCLE     (0b0011)  /* 3 clean channel values outside threshold range generates an interrupt  */
                      00026 ;    #define TCS34725_PERS_5_CYCLE     (0b0100)  /* 5 clean channel values outside threshold range generates an interrupt  */
                      00027 ;    #define TCS34725_PERS_10_CYCLE    (0b0101)  /* 10 clean channel values outside threshold range generates an interrupt */
                      00028 ;    #define TCS34725_PERS_15_CYCLE    (0b0110)  /* 15 clean channel values outside threshold range generates an interrupt */
                      00029 ;    #define TCS34725_PERS_20_CYCLE    (0b0111)  /* 20 clean channel values outside threshold range generates an interrupt */
                      00030 ;    #define TCS34725_PERS_25_CYCLE    (0b1000)  /* 25 clean channel values outside threshold range generates an interrupt */
                      00031 ;    #define TCS34725_PERS_30_CYCLE    (0b1001)  /* 30 clean channel values outside threshold range generates an interrupt */
                      00032 ;    #define TCS34725_PERS_35_CYCLE    (0b1010)  /* 35 clean channel values outside threshold range generates an interrupt */
                      00033 ;    #define TCS34725_PERS_40_CYCLE    (0b1011)  /* 40 clean channel values outside threshold range generates an interrupt */
                      00034 ;    #define TCS34725_PERS_45_CYCLE    (0b1100)  /* 45 clean channel values outside threshold range generates an interrupt */
                      00035 ;    #define TCS34725_PERS_50_CYCLE    (0b1101)  /* 50 clean channel values outside threshold range generates an interrupt */
                      00036 ;    #define TCS34725_PERS_55_CYCLE    (0b1110)  /* 55 clean channel values outside threshold range generates an interrupt */
                      00037 ;    #define TCS34725_PERS_60_CYCLE    (0b1111)  /* 60 clean channel values outside threshold range generates an interrupt */
                      00038 ;    #define TCS34725_CONFIG           (0x0D)
                      00039 ;    #define TCS34725_CONFIG_WLONG     (0x02)    /* Choose between short and long (12x) wait times via TCS34725_WTIME */
                      00040 ;    #define TCS34725_CONTROL          (0x0F)    /* Set the gain level for the sensor */
                      00041 ;    #define TCS34725_ID               (0x12)    /* 0x44 = TCS34721/TCS34725, 0x4D = TCS34723/TCS34727 */
                      00042 ;    #define TCS34725_STATUS           (0x13)
                      00043 ;    #define TCS34725_STATUS_AINT      (0x10)    /* RGBC Clean channel interrupt */
                      00044 ;    #define TCS34725_STATUS_AVALID    (0x01)    /* Indicates that the RGBC channels have completed an integration cycle */
                      00045 ;    #define TCS34725_CDATAL           (0x14)    /* Clear channel data */
                      00046 ;    #define TCS34725_CDATAH           (0x15)
                      00047 ;    #define TCS34725_RDATAL           (0x16)    /* Red channel data */
                      00048 ;    #define TCS34725_RDATAH           (0x17)
                      00049 ;    #define TCS34725_GDATAL           (0x18)    /* Green channel data */
                      00050 ;    #define TCS34725_GDATAH           (0x19)
                      00051 ;    #define TCS34725_BDATAL           (0x1A)    /* Blue channel data */
                      00052 ;    #define TCS34725_BDATAH           (0x1B)
                      00053 
                      00054 
Warning[207]: Found label after column 1. (COLOUR_INIT)
                      00055     COLOUR_INIT macro
                      00056         COLOUR_WRITE    0x00, 0x01 ; Enable Register (0x00), Power ON (0x01)
                      00057         call    delay5ms
                      00058         COLOUR_WRITE    0x00, 0x02 ; Enable Register (0x00), RGBC enable (0x02)
                      00059         call    delay5ms
                      00060         COLOUR_WRITE    0x01, 0xff ; Timing Register (0x01), 2.4ms (0xff) cycle
                      00061         call    delay5ms
                      00062         COLOUR_WRITE    0x0f, 0x03 ; Control Register (0x0f), 60x gain (0x03)
                      00063         call    delay5ms
                      00064     endm
                      00065     
Warning[207]: Found label after column 1. (COLOUR_READ)
                      00066     COLOUR_READ  macro  address
                      00067         movlw   address
                      00068         movwf   regaddress
                      00069         call    READ_COLOUR_I2C
                      00070     endm
                      00071     
Warning[207]: Found label after column 1. (COLOUR_WRITE)
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00072     COLOUR_WRITE macro address, datliteral
                      00073         movlw   address
                      00074         movwf   regaddress
                      00075         movlw   datliteral
                      00076         movwf   databyte
                      00077         call    WRITE_COLOUR_I2C
                      00078     endm
                      00079     
Warning[207]: Found label after column 1. (COLOUR_GET_DATA)
                      00080     COLOUR_GET_DATA macro clear, red, green, blue
                      00081         call    delay5ms
                      00082         
                      00083         COLOUR_READ 0x14    ; read clear colour address low, command bits set later
                      00084         movff   databyte, clear+0
                      00085         COLOUR_READ 0x15    ; read clear colour address high, command bits set later
                      00086         movff   databyte, clear+1
                      00087                 
                      00088         COLOUR_READ 0x16    ; read red colour address low, command bits set later
                      00089         movff   databyte, red+0
                      00090         COLOUR_READ 0x17    ; read red colour address high, command bits set later
                      00091         movff   databyte, red+0
                      00092         
                      00093         COLOUR_READ 0x18    ; read green colour address low, command bits set later
                      00094         movff   databyte, green+0
                      00095         COLOUR_READ 0x19    ; read green colour address high, command bits set later
                      00096         movff   databyte, green+1
                      00097         
                      00098         COLOUR_READ 0x1a    ; read blue colour address low, command bits set later
                      00099         movff   databyte, blue+0
                      00100         COLOUR_READ 0x1b    ; read blue colour address high, command bits set later
                      00101         movff   databyte, blue+1
                      00102     endm
                      00103     
                      00019 #include <sorting.inc>
  0000                00001     extern  i2c_common_setup, regaddress, databyte, datachar, READ_ARDUINO, INIT_ARDUINO, WR_DATA, delay5ms
                      00002     
Warning[207]: Found label after column 1. (ARDUINO_READ)
                      00003     ARDUINO_READ macro bottle_sort
                      00004         call    READ_ARDUINO
                      00005         movff   WREG, bottle_sort
                      00006     endm
                      00007     
                      00008 
                      00009 
                      00010 
                      00020 
                      00021     CONFIG OSC=HS, FCMEN=OFF, IESO=OFF
                      00022     CONFIG PWRT = OFF, BOREN = SBORDIS, BORV = 3
                      00023     CONFIG WDT = OFF, WDTPS = 32768
                      00024     CONFIG MCLRE = ON, LPT1OSC = OFF, PBADEN = OFF
                      00025     CONFIG STVREN = ON, LVP = OFF, XINST = OFF
                      00026     CONFIG DEBUG = OFF
                      00027     CONFIG CP0 = OFF, CP1 = OFF, CP2 = OFF, CP3 = OFF
                      00028     CONFIG CPB = OFF, CPD = OFF
                      00029     CONFIG WRT0 = OFF, WRT1 = OFF, WRT2 = OFF, WRT3 = OFF
                      00030     CONFIG WRTB = OFF, WRTC = OFF, WRTD = OFF
                      00031     CONFIG EBTR0 = OFF, EBTR1 = OFF, EBTR2 = OFF, EBTR3 = OFF
                      00032     CONFIG EBTRB = OFF
                      00033 
                      00034 ;*******************************************************************************
                      00035 ; variable and constants
                      00036 ;*******************************************************************************
                      00037     CODE
                      00038             
                      00039     cblock 0x00
  00000000            00040         key1
  00000001            00041         key2
  00000002            00042         key3
  00000003            00043         keyA
  00000004            00044         key4
  00000005            00045         key5
  00000006            00046         key6
  00000007            00047         keyB
  00000008            00048         key7
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

  00000009            00049         key8
  0000000A            00050         key9
  0000000B            00051         keyC
  0000000C            00052         keyS
  0000000D            00053         key0
  0000000E            00054         keyH
  0000000F            00055         keyD
  00000010            00056         KEY
  00000011            00057         temp_KEY
  00000012            00058         KEY_ISR
  00000013            00059         temp_S  
  00000014            00060         temp_W
  00000015            00061         counter
  00000016            00062         counter2
  00000017            00063         temp
  00000018            00064         OP_sec
  00000019            00065         OP_INT
  0000001A            00066         delayR
  0000001B            00067         d5us
  0000001C            00068         d200us
  0000001D            00069         d50ms
  0000001E            00070         inExecution
  0000001F            00071         clear_EE
  00000020            00072         H_EE    
  00000021            00073         L_EE    
  00000022            00074         REG_EE  
  00000023            00075         tempH_EE
  00000024            00076         tempL_EE
  00000025            00077         tempL_EEC
  00000026            00078         MAX_EE   
  00000027            00079         last_log
  00000028            00080         transferring
  00000029            00081         PC_PCL
  0000002A            00082         PC_PCLATH
  0000002B            00083         PC_PCLATU
  0000002C            00084         DETECTION_VAL
  0000002D            00085         ESKA
  0000002E            00086         ESKA_NOCAP
  0000002F            00087         YOP
  00000030            00088         YOP_NOCAP
  00000031            00089         TOTAL_BOTTLES
  00000032            00090         COLLECTIONS_COUNT
  00000033            00091         TRAY_COUNT
  00000034            00092         TRAY_DELAY
  00000035            00093         TRAY_CURRENT
  00000036            00094         TRAY_GOTO
  00000037            00095         STOP_CONDITION
  00000038            00096         inStandby
                      00097     endc
                      00098     
  0000                00099     extern tens_digit, ones_digit
  0000                00100     extern READ_ARDUINO, INIT_RTC
                      00101     
                      00102 ;*******************************************************************************
                      00103 ; tables
                      00104 ;*******************************************************************************
Warning[207]: Found label after column 1. (Welcome)
000000 6F62 4C74 0000 00105     Welcome     db          "botL", 0
Warning[207]: Found label after column 1. (Team)
000006 726D 6820 206C 00106     Team        db          "mr hl hg", 0
       6768 0000 
Warning[207]: Found label after column 1. (StandBy)
000010 7453 6E61 6964 00107     StandBy     db          "Standing by ... ... Standing by ... ...", 0
       676E 6220 2079 
       2E2E 202E 2E2E 
       202E 7453 6E61 
       6964 676E 6220 
       2079 2E2E 202E 
       2E2E 002E 
Warning[207]: Found label after column 1. (StandbyInfo)
000038 413C 533E 726F 00108     StandbyInfo db          "<A>Sort <B>Last Log <C>Perm Logs <D>PC", 0
       2074 423C 4C3E 
       7361 2074 6F4C 
       2067 433C 503E 
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

       7265 206D 6F4C 
       7367 3C20 3E44 
       4350 0000 
Warning[207]: Found label after column 1. (Log1)
000060 6954 656D 003A 00109     Log1        db          "Time:",0
Warning[207]: Found label after column 1. (Log2)
000066 3231 303A 2030 00110     Log2        db          "12:00 2/3/14", 0
       2F32 2F33 3431 
       0000 
Warning[207]: Found label after column 1. (LogInfo1)
000074 6153 6576 3A64 00111     LogInfo1    db          "Saved:", 0
       0000 
Warning[207]: Found label after column 1. (LogInfo2)
00007C 6142 6B63 3C20 00112     LogInfo2    db          "Back <0>", 0
       3E30 0000 
Warning[207]: Found label after column 1. (PermLog1)
000086 6550 6D72 6E61 00113     PermLog1    db          "Permanent Logs", 0
       6E65 2074 6F4C 
       7367 0000 
Warning[207]: Found label after column 1. (PermLog2)
000096 313C 203E 2E2E 00114     PermLog2    db          "<1> ... <9>", 0    
       202E 393C 003E 
Warning[207]: Found label after column 1. (Exe1)
0000A2 6F53 7472 6E69 00115     Exe1        db          "Sorting...", 0
       2E67 2E2E 0000 
Warning[207]: Found label after column 1. (Exe2)
0000AE 4E45 2044 2A3C 00116     Exe2        db          "END <*>", 0
       003E 
Warning[207]: Found label after column 1. (PC1)
0000B6 4350 4920 746E 00117     PC1         db          "PC Interface", 0
       7265 6166 6563 
       0000 
Warning[207]: Found label after column 1. (PC2)
0000C4 6542 6967 206E 00118     PC2         db          "Begin <#>", 0
       233C 003E 
Warning[207]: Found label after column 1. (PCTransfer)
0000CE 7254 6E61 6673 00119     PCTransfer  db          "Transferring...", 0
       7265 6972 676E 
       2E2E 002E 
Warning[207]: Found label after column 1. (PCComplete)
0000DE 6F43 706D 656C 00120     PCComplete  db          "Complete!", 0
       6574 0021 
Warning[207]: Found label after column 1. (SAVE)
0000E8 6153 6976 676E 00121     SAVE        db          "Saving...", 0
       2E2E 002E 
Warning[207]: Found label after column 1. (NoData)
0000F2 2F4E 0041      00122     NoData      db          "N/A", 0
                      00123         
                      00124 ;*******************************************************************************
                      00125 ; macros
                      00126 ;*******************************************************************************
                      00127         
                      00128 ConfigLCD   macro
                      00129           movlw     b'00101000'    ; 4 bits, 2 lines,5X7 dots seems to work best instead of the above setting
                      00130           call      WR_INS
                      00131 
                      00132           movlw     b'00001100'    ; display on/off
                      00133           call      WR_INS
                      00134           movlw     b'00000001'    ; Clear ram
                      00135           call      WR_INS
                      00136           endm
                      00137 
                      00138 Delay50N macro count, N
                      00139         local   loop
                      00140         movlw   N
                      00141         movwf   count
                      00142 
                      00143 loop
                      00144         call    Delay50ms
                      00145         decfsz  count
                      00146         goto    loop
                      00147         endm
                      00148 
                      00149 Display macro   Message
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00150         local   loop
                      00151         movlw   upper Message   ; Move Table<20:16>
                      00152         movwf   TBLPTRU
                      00153         movlw   high Message    ; Move Table<15:8>
                      00154         movwf   TBLPTRH
                      00155         movlw   low Message     ; Move Table<7:0>
                      00156         movwf   TBLPTRL
                      00157         tblrd*                  ; Read byte from TBLPTRL to TABLAT
                      00158         movf    TABLAT, W
                      00159 loop
                      00160         call    WR_DATA         ; write to LCD
                      00161         tblrd+*                 ; next row in table
                      00162         movf    TABLAT, W
                      00163         bnz     loop
                      00164         endm    
                      00165 
                      00166 incf_BCD    macro   BCD
                      00167         local ones, endBCD
                      00168         movff   BCD, temp
                      00169         
                      00170         ;process ones digit
                      00171         movlw   0x0f
                      00172         andwf   temp
                      00173         movlw   d'9'
                      00174         
                      00175         ;skip if ones digit is 9
                      00176         cpfseq  temp
                      00177         goto    ones
                      00178         
                      00179         movlw   b'00010000'
                      00180         addwf   BCD
                      00181         movlw   0xf0
                      00182         andwf   BCD
                      00183         movlw   0xa0
                      00184         cpfslt  BCD
                      00185         
                      00186         clrf    BCD
                      00187         goto    endBCD
                      00188         
                      00189 ones
                      00190         incf    BCD
                      00191         goto    endBCD
                      00192 endBCD
                      00193         nop
                      00194         endm
                      00195 
                      00196 WriteEE macro   word, addH, addL
                      00197         movff   addH, EEADRH        ; High address
                      00198         movff   addL, EEADR         ; Low address
                      00199         movff   word, EEDATA        ; set word
                      00200 
                      00201         btfsc   EECON1, WR          ; test if WR=0, skip if so
                      00202         bra     $-2
                      00203 
                      00204         bcf     EECON1, EEPGD       ; Point to data memory
                      00205         bcf     EECON1, CFGS        ; Access EEPROM
                      00206         bsf     EECON1, WREN        ; enable write
                      00207         bcf     INTCON, GIE         ; disable interrupts during write
                      00208         bcf     PIR2, EEIF
                      00209 
                      00210         movlw   0x55
                      00211         movwf   EECON2              ; write 55h
                      00212         movlw   0xaa
                      00213         movwf   EECON2              ; write 0xaa
                      00214         bsf     EECON1, WR          ; begin write
                      00215         btfsc   EECON1, WR
                      00216         bra     $-2
                      00217 
                      00218         bsf     INTCON, GIE         ; enable interrupts after write
                      00219         bcf     EECON1, WREN        ; disable writes
                      00220         endm
                      00221 
                      00222 READEE  macro   file, addH, addL
                      00223         movff   addH, EEADRH        ; read to high
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00224         movff   addL, EEADR         ; read to low
                      00225         bcf     EECON1, EEPGD       ; point to data memory
                      00226         bcf     EECON1, CFGS        ; access to EEPROM
                      00227         bsf     EECON1, RD          ; read EEPROM
                      00228         movff   EEDATA, file        ; put data into file
                      00229         endm
                      00230 
                      00231 ChangeMode  macro   ModeId, NextMode
                      00232         local Next, Exit
                      00233 
                      00234         movlw   ModeId              ; poll for mode
                      00235         cpfseq  KEY                 ; check this against key press
                      00236         goto    Exit
                      00237 
                      00238 Next
                      00239         clrf    LATA                ; clear pins before proceeding
                      00240         clrf    LATB
                      00241         clrf    LATC
                      00242         clrf    LATD
                      00243         goto    NextMode
                      00244 
                      00245 Exit
                      00246         nop
                      00247         endm
                      00248 
                      00249 saveContext macro
                      00250     movff   STATUS, temp_S          ; save STATUS first
                      00251     movwf   temp_W                  ; save W
                      00252     endm
                      00253 
                      00254 restoreContext macro
                      00255     swapf   temp_W, 0               ; restore W first
                      00256     movff   temp_S, STATUS          ; restore STATUS last without affecting W
                      00257     endm
                      00258 ;*******************************************************************************
                      00259 ; reset vector and isrs
                      00260 ;*******************************************************************************
                      00261         ORG     0x000               ; processor reset vector
000000 EF?? F???      00262         goto    INIT                ; go to beginning of program
                      00263 
                      00264         ORG     0x008
000008 EF?? F???      00265         goto    ISR_HIGH
                      00266 
                      00267         ORG     0x018
000018 EF?? F???      00268         goto    ISR_LOW
                      00269 
00001C                00270 EMERGENCY_STOP
                      00271         ; first check if we're currently sorting - else, no need to restart
00001C 0EFF           00272         movlw   0xff                ; if in operation, skip return
00001E 621E           00273         cpfseq  inExecution
000020 EF?? F???      00274         goto    END_ISR_HIGH
                      00275         
                      00276         ; reset program counter - emergency stop recorded. 
000024 9ED5           00277         bcf     T0CON, TMR0ON
000026 EC?? F???      00278         call    SAVE_EXE_TIME
                      00279         
                      00280         ; reset emergency stop interrupt bit
00002A 92F2           00281         bcf     INTCON, INT0IF
                      00282                 
                      00283         ; clear inExecution flag
00002C 6A1E           00284         clrf    inExecution
00002E 0E01           00285         movlw   d'1'
000030 6E37           00286         movwf   STOP_CONDITION
000032 EC?? F???      00287         call    SaveData
                      00288         
000036 6AFF           00289         clrf    TOSU
000038 6AFE           00290         clrf    TOSH
00003A 6AFD           00291         clrf    TOSL
00003C 90F0           00292         bcf     INTCON3, INT1IF         ; Clear flag for next interrupt
                      00293         restoreContext
00003E 3814               M     swapf   temp_W, 0               ; restore W first
000040 C013 FFD8          M     movff   temp_S, STATUS          ; restore STATUS last without affecting W
000044 0010           00294         retfie
                      00295 
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

000046                00296 LOAD_STANDBY_TIME
000046 0EFF           00297         movlw   0xff
000048 6ED7           00298         movwf   TMR0H
00004A 0EFF           00299         movlw   0xff
00004C 6ED6           00300         movwf   TMR0L
                      00301 
00004E 0012           00302         return  
                      00303 
000050                00304 LOAD_EXE_TIME
000050 0EC3           00305         movlw   0xc3
000052 6ED7           00306         movwf   TMR0H
000054 0E25           00307         movlw   0x25
000056 6ED6           00308         movwf   TMR0L
                      00309         
000058 0012           00310         return
                      00311         
00005A                00312 ISR_HIGH
                      00313         saveContext
00005A CFD8 F013          M     movff   STATUS, temp_S          ; save STATUS first
00005E 6E14               M     movwf   temp_W                  ; save W
                      00314         
                      00315 ;       btfsc   INTCON, INT0IF
                      00316 ;       call    EMERGENCY_STOP
                      00317         
000060 0E00           00318         movlw   0x00
000062 6238           00319         cpfseq  inStandby
000064 EC?? F???      00320         call    Shift
                      00321         
                      00322         ;reset timer, but need to check which time increment 
000068 0E00           00323         movlw   0x00
00006A 6238           00324         cpfseq  inStandby
00006C EC?? F???      00325         call    LOAD_STANDBY_TIME
                      00326         
000070 0EFF           00327         movlw   0xff
000072 6238           00328         cpfseq  inStandby
000074 EC?? F???      00329         call    LOAD_EXE_TIME
                      00330 
                      00331                 
                      00332         ; displaying the execution time in seconds
                      00333 ;       swapf   OP_sec, 0       ; 100's seconds
                      00334 ;       movwf   temp
                      00335 ;       movlw   0x0f
                      00336 ;       andwf   temp
                      00337 ;       movff   temp, WREG
                      00338 ;       addlw   0x30
                      00339 ;       call    WR_DATA
                      00340 ;
                      00341 ;       movff   OP_sec, temp    ; 10's seconds
                      00342 ;       movlw   0x0f
                      00343 ;       andwf   temp            ; Temp = lower nibble of Op_sec
                      00344 ;       movff   temp, WREG      ; W = Temp
                      00345 ;       addlw   0x30            ; Convert to ASCII
                      00346 ;       call    WR_DATA
                      00347 ;       
                      00348 ;       swapf   OP_INT, WREG    ;1's seconds
                      00349 ;       movwf   temp
                      00350 ;       movlw   0x0f
                      00351 ;       andwf   temp
                      00352 ;       movff   temp, WREG
                      00353 ;       addlw   0x30
                      00354 ;       call    WR_DATA
                      00355 ;
                      00356 ;       movlw   0x73            ; Write 's'
                      00357 ;       call    WR_DATA
                      00358 ;       call    LCD_L2
                      00359                 
                      00360         ;timer interrupt
000078 A4F2           00361         btfss   INTCON, TMR0IF
00007A EF?? F???      00362         goto    END_ISR_HIGH
                      00363         
                      00364         incf_BCD    OP_INT
  0000                    M         local ones, endBCD
00007E C019 F017          M         movff   OP_INT, temp
                          M         
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                          M         ;process ones digit
000082 0E0F               M         movlw   0x0f
000084 1617               M         andwf   temp
000086 0E09               M         movlw   d'9'
                          M         
                          M         ;skip if ones digit is 9
000088 6217               M         cpfseq  temp
00008A EF?? F???          M         goto    ones
                          M         
00008E 0E10               M         movlw   b'00010000'
000090 2619               M         addwf   OP_INT
000092 0EF0               M         movlw   0xf0
000094 1619               M         andwf   OP_INT
000096 0EA0               M         movlw   0xa0
000098 6019               M         cpfslt  OP_INT
                          M         
00009A 6A19               M         clrf    OP_INT
00009C EF?? F???          M         goto    endBCD
                          M         
0000A0                    M ones
0000A0 2A19               M         incf    OP_INT
0000A2 EF?? F???          M         goto    endBCD
0000A6                    M endBCD
0000A6 0000               M         nop
0000A8 0E00           00365         movlw   d'0'
0000AA 6219           00366         cpfseq  OP_INT
0000AC EF?? F???      00367         goto    END_ISR_HIGH
                      00368         incf_BCD    OP_sec
  0000                    M         local ones, endBCD
0000B0 C018 F017          M         movff   OP_sec, temp
                          M         
                          M         ;process ones digit
0000B4 0E0F               M         movlw   0x0f
0000B6 1617               M         andwf   temp
0000B8 0E09               M         movlw   d'9'
                          M         
                          M         ;skip if ones digit is 9
0000BA 6217               M         cpfseq  temp
0000BC EF?? F???          M         goto    ones
                          M         
0000C0 0E10               M         movlw   b'00010000'
0000C2 2618               M         addwf   OP_sec
0000C4 0EF0               M         movlw   0xf0
0000C6 1618               M         andwf   OP_sec
0000C8 0EA0               M         movlw   0xa0
0000CA 6018               M         cpfslt  OP_sec
                          M         
0000CC 6A18               M         clrf    OP_sec
0000CE EF?? F???          M         goto    endBCD
                          M         
0000D2                    M ones
0000D2 2A18               M         incf    OP_sec
0000D4 EF?? F???          M         goto    endBCD
0000D8                    M endBCD
0000D8 0000               M         nop
                      00369 
0000DA                00370 END_ISR_HIGH
0000DA 94F2           00371         bcf     INTCON, TMR0IF
                      00372         restoreContext
0000DC 3814               M     swapf   temp_W, 0               ; restore W first
0000DE C013 FFD8          M     movff   temp_S, STATUS          ; restore STATUS last without affecting W
0000E2 0010           00373         retfie
                      00374 
0000E4                00375 ISR_LOW
                      00376         saveContext
0000E4 CFD8 F013          M     movff   STATUS, temp_S          ; save STATUS first
0000E8 6E14               M     movwf   temp_W                  ; save W
                      00377         ; KEYPAD INTERRUPT
0000EA A0F0           00378         btfss   INTCON3, INT1IF         ; If KEYPAD interrupt, skip return
0000EC EF?? F???      00379         goto    END_ISR_LOW
                      00380 
                      00381         ; check operation status
0000F0 0EFF           00382         movlw   0xff                    ; If in operation, skip return
0000F2 621E           00383         cpfseq  inExecution
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0000F4 EF?? F???      00384         goto    END_ISR_LOW
                      00385 
                      00386         ; process KEY
0000F8 3881           00387         swapf   PORTB, 0                ; Read PORTB<7:4> into W<3:0>
0000FA 0B0F           00388         andlw   0x0f
0000FC 6E12           00389         movwf   KEY_ISR
                      00390         
0000FE 0E0C           00391         movlw   keyS                    ; Put keyStar into W to compare to KEY_ISR
000100 6212           00392         cpfseq  KEY_ISR                 ; If key was '*', skip return
000102 EF?? F???      00393         goto    END_ISR_LOW
                      00394         
                      00395         ; reset program counter - emergency stop recorded. 
000106 9ED5           00396         bcf     T0CON, TMR0ON
000108 EC?? F???      00397         call    SAVE_EXE_TIME
                      00398                 
                      00399         ; Clear inExecution flag to stop '*' interrupts
00010C 6A1E           00400         clrf    inExecution
00010E 0E01           00401         movlw   d'1'
000110 6E37           00402         movwf   STOP_CONDITION
000112 EC?? F???      00403         call    SaveData
                      00404         
000116 6AFF           00405         clrf    TOSU
000118 6AFE           00406         clrf    TOSH
00011A 6AFD           00407         clrf    TOSL
00011C 90F0           00408         bcf     INTCON3, INT1IF         ; Clear flag for next interrupt
                      00409         restoreContext
00011E 3814               M     swapf   temp_W, 0               ; restore W first
000120 C013 FFD8          M     movff   temp_S, STATUS          ; restore STATUS last without affecting W
000124 0010           00410         retfie
                      00411 
000126                00412 END_ISR_LOW
000126 90F0           00413         bcf                     INTCON3, INT1IF         ; Clear flag for next interrupt
                      00414         restoreContext
000128 3814               M     swapf   temp_W, 0               ; restore W first
00012A C013 FFD8          M     movff   temp_S, STATUS          ; restore STATUS last without affecting W
00012E 0010           00415         retfie
                      00416 
                      00417 ;*******************************************************************************
                      00418 ; main
                      00419 ;*******************************************************************************
000130                00420 INIT
000130 0E70           00421         movlw   b'01110000'     ;Set internal oscillator frequency to 8MHz
000132 6ED3           00422         movwf   OSCCON
                      00423         
                      00424         ; i/o
000134 0E00           00425         movlw   b'00000000'
000136 6E92           00426         movwf   TRISA
000138 0EFF           00427         movlw   b'11111111'
00013A 6E93           00428         movwf   TRISB               ; keypad
00013C 0E00           00429         movlw   b'00000000'
00013E 6E94           00430         movwf   TRISC
000140 0E00           00431         movlw   b'00000000'
000142 6E95           00432         movwf   TRISD
000144 0E00           00433         movlw   b'00000000'
000146 6E96           00434         movwf   TRISE
                      00435 
                      00436         ; clear ports
000148 0E00           00437         movlw   b'00000000'
00014A 6E89           00438         movwf   LATA
00014C 0E00           00439         movlw   b'00000000'
00014E 6E8A           00440         movwf   LATB
000150 0E00           00441         movlw   b'00000000'
000152 6E8B           00442         movwf   LATC
000154 0E00           00443         movlw   b'00000000'
000156 6E8C           00444         movwf   LATD
000158 0E00           00445         movlw   b'00000000'
00015A 6E8D           00446         movwf   LATE
                      00447         
00015C 0E00           00448         movlw   b'00000000'
00015E 6EC2           00449         movwf   ADCON0
                      00450 ;       movlw   b'11111111'
                      00451 ;       movwf   ADCON1
                      00452         
                      00453         ; setting up pwm
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00454 ;       clrf    CM1CONO         ; disable comparators
                      00455 ;       clrf    CM2CONO
                      00456 ;       movlw   0x3c            ; pwm mode and 2 lsb of duty cycle
                      00457 ;       movwf   CCP2CON
                      00458 ;       movlw   0x00            ; bits 9:2 of pwm duty cycle
                      00459 ;       movwf   CCPR2L
                      00460 ;       
                      00461 ;       bcf     PIR1, TMR2IF
                      00462 ;       bcf     T2CON, T2CKPS1
                      00463 ;       bsf     T2CON, TMR2ON
                      00464         
                      00465         ; initializations
000160 EC?? F???      00466         call    InitLCD
                      00467         ConfigLCD
000164 0E28               M           movlw     b'00101000'    ; 4 bits, 2 lines,5X7 dots seems to work best instead of the above setting
000166 EC?? F???          M           call      WR_INS
                          M 
00016A 0E0C               M           movlw     b'00001100'    ; display on/off
00016C EC?? F???          M           call      WR_INS
000170 0E01               M           movlw     b'00000001'    ; Clear ram
000172 EC?? F???          M           call      WR_INS
                      00468         
000176 EC?? F???      00469         call    i2c_common_setup
                      00470         
00017A EC?? F???      00471         call    RTC_INIT
                      00472         ;COLOUR_INIT
00017E EC?? F???      00473         call    INIT_USART
                      00474 
                      00475         ; interrupts
000182 6AD0           00476         clrf    RCON
000184 6AF2           00477         clrf    INTCON
000186 6AF1           00478         clrf    INTCON2
000188 6AF0           00479         clrf    INTCON3
00018A 8ED0           00480         bsf     RCON, IPEN          ; priority mode
00018C 8EF2           00481         bsf     INTCON, GIEH        ; permit global interrupts
00018E 8CF2           00482         bsf     INTCON, GIEL
000190 8AF1           00483         bsf     INTCON2, INTEDG1    ; INTEDG1 on rising edge
000192 8AF2           00484         bsf     INTCON, TMR0IE      ; clear timer0 overflow interrupt flag
000194 84F2           00485         bsf     INTCON, TMR0IF      ; clear timer0 overflow interrupt flag
000196 84F1           00486         bsf     INTCON2, TMR0IP     ; set to high priority
000198 86F0           00487         bsf     INTCON3, INT1IE     ; enable interrupts on rb1 for keyboard
00019A 9CF0           00488         bcf     INTCON3, INT1IP     ; keyboard to low priority
                      00489 ;       bsf     INTCON, INT0IE      ; enable high interrupts on rb0 for emergency stop
                      00490 ;       bcf     INTCON, INT0IF      ; clear emergency stop interrupt
                      00491         
                      00492         ; setting up timer to sychronize with 1 second clock intervals
00019C 9ED5           00493         bcf     T0CON, TMR0ON
00019E 9CD5           00494         bcf     T0CON, T08BIT
0001A0 9AD5           00495         bcf     T0CON, T0CS
0001A2 98D5           00496         bcf     T0CON, T0SE
0001A4 96D5           00497         bcf     T0CON, PSA
0001A6 94D5           00498         bcf     T0CON, T0PS2        ; set prescaling to 1:16.
0001A8 82D5           00499         bsf     T0CON, T0PS1
0001AA 80D5           00500         bsf     T0CON, T0PS0
                      00501 
0001AC 6A20           00502         clrf    H_EE
0001AE 6A21           00503         clrf    L_EE
0001B0 6A??           00504         clrf    tens_digit
0001B2 6A??           00505         clrf    ones_digit
                      00506         
0001B4 6A2C           00507         clrf    DETECTION_VAL
0001B6 6A2D           00508         clrf    ESKA
0001B8 6A2E           00509         clrf    ESKA_NOCAP
0001BA 6A2F           00510         clrf    YOP
0001BC 6A30           00511         clrf    YOP_NOCAP
0001BE 6A31           00512         clrf    TOTAL_BOTTLES
0001C0 6A32           00513         clrf    COLLECTIONS_COUNT
                      00514         
0001C2 0EF2           00515         movlw     b'11110010'    ; Set required keypad inputs
0001C4 6E93           00516         movwf     TRISB
                      00517         
0001C6 EC?? F???      00518         call    ClrLCD
                      00519         Display Welcome
  0000                    M         local   loop
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0001CA 0E??               M         movlw   upper Welcome   ; Move Table<20:16>
0001CC 6EF8               M         movwf   TBLPTRU
0001CE 0E??               M         movlw   high Welcome    ; Move Table<15:8>
0001D0 6EF7               M         movwf   TBLPTRH
0001D2 0E??               M         movlw   low Welcome     ; Move Table<7:0>
0001D4 6EF6               M         movwf   TBLPTRL
0001D6 0008               M         tblrd*                  ; Read byte from TBLPTRL to TABLAT
0001D8 50F5               M         movf    TABLAT, W
0001DA                    M loop
0001DA EC?? F???          M         call    WR_DATA         ; write to LCD
0001DE 000B               M         tblrd+*                 ; next row in table
0001E0 50F5               M         movf    TABLAT, W
0001E2 E1??               M         bnz     loop
0001E4 EC?? F???      00520         call LCD_L2
                      00521         Display Team
  0000                    M         local   loop
0001E8 0E??               M         movlw   upper Team      ; Move Table<20:16>
0001EA 6EF8               M         movwf   TBLPTRU
0001EC 0E??               M         movlw   high Team       ; Move Table<15:8>
0001EE 6EF7               M         movwf   TBLPTRH
0001F0 0E??               M         movlw   low Team        ; Move Table<7:0>
0001F2 6EF6               M         movwf   TBLPTRL
0001F4 0008               M         tblrd*                  ; Read byte from TBLPTRL to TABLAT
0001F6 50F5               M         movf    TABLAT, W
0001F8                    M loop
0001F8 EC?? F???          M         call    WR_DATA         ; write to LCD
0001FC 000B               M         tblrd+*                 ; next row in table
0001FE 50F5               M         movf    TABLAT, W
000200 E1??               M         bnz     loop
                      00522         
                      00523         Delay50N delayR, 0x28
  0000                    M         local   loop
000202 0E28               M         movlw   0x28
000204 6E1A               M         movwf   delayR
                          M 
000206                    M loop
000206 EC?? F???          M         call    Delay50ms
00020A 2E1A               M         decfsz  delayR
00020C EF?? F???          M         goto    loop
                      00524 
                      00525 ;*******************************************************************************
                      00526 ; standby mode
                      00527 ;*******************************************************************************
000210                00528 STANDBY
000210 0E00           00529         movlw   b'00000000'
000212 6E84           00530         movwf   PORTE
000214 0E00           00531         movlw   b'00000000'
000216 6E80           00532         movwf   PORTA
                      00533         
000218 6838           00534         setf    inStandby       
00021A EC?? F???      00535         call    ClrLCD
                      00536         Display StandBy
  0000                    M         local   loop
00021E 0E??               M         movlw   upper StandBy   ; Move Table<20:16>
000220 6EF8               M         movwf   TBLPTRU
000222 0E??               M         movlw   high StandBy    ; Move Table<15:8>
000224 6EF7               M         movwf   TBLPTRH
000226 0E??               M         movlw   low StandBy     ; Move Table<7:0>
000228 6EF6               M         movwf   TBLPTRL
00022A 0008               M         tblrd*                  ; Read byte from TBLPTRL to TABLAT
00022C 50F5               M         movf    TABLAT, W
00022E                    M loop
00022E EC?? F???          M         call    WR_DATA         ; write to LCD
000232 000B               M         tblrd+*                 ; next row in table
000234 50F5               M         movf    TABLAT, W
000236 E1??               M         bnz     loop
000238 EC?? F???      00537         call    LCD_L2
                      00538         Display StandbyInfo
  0000                    M         local   loop
00023C 0E??               M         movlw   upper StandbyInfo ; Move Table<20:16>
00023E 6EF8               M         movwf   TBLPTRU
000240 0E??               M         movlw   high StandbyInfo ; Move Table<15:8>
000242 6EF7               M         movwf   TBLPTRH
000244 0E??               M         movlw   low StandbyInfo ; Move Table<7:0>
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

000246 6EF6               M         movwf   TBLPTRL
000248 0008               M         tblrd*                  ; Read byte from TBLPTRL to TABLAT
00024A 50F5               M         movf    TABLAT, W
00024C                    M loop
00024C EC?? F???          M         call    WR_DATA         ; write to LCD
000250 000B               M         tblrd+*                 ; next row in table
000252 50F5               M         movf    TABLAT, W
000254 E1??               M         bnz     loop
                      00539         
000256 0EFF           00540         movlw   0xff
000258 6ED7           00541         movwf   TMR0H
00025A 0EFF           00542         movlw   0xff
00025C 6ED6           00543         movwf   TMR0L
00025E 8ED5           00544         bsf     T0CON, TMR0ON       ; turning on timer
                      00545 
                      00546 
000260                00547 HOLD_STANDBY
000260 EC?? F???      00548         call    READ_KEY_TIME
                      00549 
                      00550         ChangeMode  key1, COLOUR_TEST
  0000                    M         local Next, Exit
                          M 
000264 0E00               M         movlw   key1                ; poll for mode
000266 6210               M         cpfseq  KEY                 ; check this against key press
000268 EF?? F???          M         goto    Exit
                          M 
00026C                    M Next
00026C 6A89               M         clrf    LATA                ; clear pins before proceeding
00026E 6A8A               M         clrf    LATB
000270 6A8B               M         clrf    LATC
000272 6A8C               M         clrf    LATD
000274 EF?? F???          M         goto    COLOUR_TEST
                          M 
000278                    M Exit
000278 0000               M         nop
                      00551         ChangeMode  key2, STEP_TEST
  0000                    M         local Next, Exit
                          M 
00027A 0E01               M         movlw   key2                ; poll for mode
00027C 6210               M         cpfseq  KEY                 ; check this against key press
00027E EF?? F???          M         goto    Exit
                          M 
000282                    M Next
000282 6A89               M         clrf    LATA                ; clear pins before proceeding
000284 6A8A               M         clrf    LATB
000286 6A8B               M         clrf    LATC
000288 6A8C               M         clrf    LATD
00028A EF?? F???          M         goto    STEP_TEST
                          M 
00028E                    M Exit
00028E 0000               M         nop
                      00552         ChangeMode  keyA, EXECUTION
  0000                    M         local Next, Exit
                          M 
000290 0E03               M         movlw   keyA                ; poll for mode
000292 6210               M         cpfseq  KEY                 ; check this against key press
000294 EF?? F???          M         goto    Exit
                          M 
000298                    M Next
000298 6A89               M         clrf    LATA                ; clear pins before proceeding
00029A 6A8A               M         clrf    LATB
00029C 6A8B               M         clrf    LATC
00029E 6A8C               M         clrf    LATD
0002A0 EF?? F???          M         goto    EXECUTION
                          M 
0002A4                    M Exit
0002A4 0000               M         nop
                      00553         ChangeMode  keyB, LOG
  0000                    M         local Next, Exit
                          M 
0002A6 0E07               M         movlw   keyB                ; poll for mode
0002A8 6210               M         cpfseq  KEY                 ; check this against key press
0002AA EF?? F???          M         goto    Exit
                          M 
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0002AE                    M Next
0002AE 6A89               M         clrf    LATA                ; clear pins before proceeding
0002B0 6A8A               M         clrf    LATB
0002B2 6A8B               M         clrf    LATC
0002B4 6A8C               M         clrf    LATD
0002B6 EF?? F???          M         goto    LOG
                          M 
0002BA                    M Exit
0002BA 0000               M         nop
                      00554         ChangeMode  keyC, PERM_LOG
  0000                    M         local Next, Exit
                          M 
0002BC 0E0B               M         movlw   keyC                ; poll for mode
0002BE 6210               M         cpfseq  KEY                 ; check this against key press
0002C0 EF?? F???          M         goto    Exit
                          M 
0002C4                    M Next
0002C4 6A89               M         clrf    LATA                ; clear pins before proceeding
0002C6 6A8A               M         clrf    LATB
0002C8 6A8B               M         clrf    LATC
0002CA 6A8C               M         clrf    LATD
0002CC EF?? F???          M         goto    PERM_LOG
                          M 
0002D0                    M Exit
0002D0 0000               M         nop
                      00555         ChangeMode  keyD, PC_MODE
  0000                    M         local Next, Exit
                          M 
0002D2 0E0F               M         movlw   keyD                ; poll for mode
0002D4 6210               M         cpfseq  KEY                 ; check this against key press
0002D6 EF?? F???          M         goto    Exit
                          M 
0002DA                    M Next
0002DA 6A89               M         clrf    LATA                ; clear pins before proceeding
0002DC 6A8A               M         clrf    LATB
0002DE 6A8B               M         clrf    LATC
0002E0 6A8C               M         clrf    LATD
0002E2 EF?? F???          M         goto    PC_MODE
                          M 
0002E6                    M Exit
0002E6 0000               M         nop
0002E8 D???           00556         bra     HOLD_STANDBY
                      00557         
                      00558 ;*******************************************************************************
                      00559 ; super fun awesome tests that are my favorite thing to do at 3am yay fun great
                      00560 ;*******************************************************************************
                      00561         
0002EA                00562 STEP_TEST
0002EA 6A38           00563         clrf    inStandby
0002EC 6A32           00564         clrf    COLLECTIONS_COUNT
                      00565         Delay50N    delayR, 0x14
  0000                    M         local   loop
0002EE 0E14               M         movlw   0x14
0002F0 6E1A               M         movwf   delayR
                          M 
0002F2                    M loop
0002F2 EC?? F???          M         call    Delay50ms
0002F6 2E1A               M         decfsz  delayR
0002F8 EF?? F???          M         goto    loop
                      00566     
0002FC                00567 ROTATE_90_TEST                      ; actually 45, but dont care to change label
0002FC 0E23           00568         movlw   b'00100011'
0002FE 6E80           00569         movwf   PORTA
000300 EC?? F???      00570         call    delay5ms
000304 EC?? F???      00571         call    delay5ms
000308 EC?? F???      00572         call    delay5ms
00030C EC?? F???      00573         call    delay5ms
000310 EC?? F???      00574         call    delay5ms
000314 EC?? F???      00575         call    delay5ms
000318 EC?? F???      00576         call    delay5ms
00031C EC?? F???      00577         call    delay5ms
                      00578 ;       incf    COLLECTIONS_COUNT
                      00579 ;       
                      00580 ;       movlw   d'15'
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00581 ;       subwf   COLLECTIONS_COUNT, 0
                      00582 ;       bz      STEP_TEST
                      00583 
000320 0E26           00584         movlw   b'00100110'
000322 6E80           00585         movwf   PORTA
000324 EC?? F???      00586         call    delay5ms
000328 EC?? F???      00587         call    delay5ms
00032C EC?? F???      00588         call    delay5ms
000330 EC?? F???      00589         call    delay5ms
000334 EC?? F???      00590         call    delay5ms
000338 EC?? F???      00591         call    delay5ms
00033C EC?? F???      00592         call    delay5ms
000340 EC?? F???      00593         call    delay5ms
                      00594 ;       incf    COLLECTIONS_COUNT
                      00595         
000344 0E2C           00596         movlw   b'00101100'
000346 6E80           00597         movwf   PORTA
000348 EC?? F???      00598         call    delay5ms
00034C EC?? F???      00599         call    delay5ms
000350 EC?? F???      00600         call    delay5ms
000354 EC?? F???      00601         call    delay5ms
000358 EC?? F???      00602         call    delay5ms
00035C EC?? F???      00603         call    delay5ms
000360 EC?? F???      00604         call    delay5ms
000364 EC?? F???      00605         call    delay5ms
                      00606 ;       incf    COLLECTIONS_COUNT
                      00607 
000368 0E29           00608         movlw   b'00101001'
00036A 6E80           00609         movwf   PORTA
00036C EC?? F???      00610         call    delay5ms
000370 EC?? F???      00611         call    delay5ms
000374 EC?? F???      00612         call    delay5ms
000378 EC?? F???      00613         call    delay5ms
00037C EC?? F???      00614         call    delay5ms
000380 EC?? F???      00615         call    delay5ms
000384 EC?? F???      00616         call    delay5ms
000388 EC?? F???      00617         call    delay5ms        
00038C 2A32           00618         incf    COLLECTIONS_COUNT
                      00619         
00038E 0E02           00620         movlw   d'2'                        ; 7 ~ 45 degrees
000390 6232           00621         cpfseq  COLLECTIONS_COUNT
000392 D???           00622         bra     ROTATE_90_TEST
                      00623         
000394 D???           00624         bra     STEP_TEST
                      00625 
000396                00626 COLOUR_TEST
000396 EC?? F???      00627         call    ClrLCD
00039A 6A38           00628         clrf    inStandby
00039C 0E01           00629         movlw   b'00000001'
00039E 6E84           00630         movwf   PORTE
                      00631 
0003A0                00632 LOOPING
                      00633         Delay50N delayR, 0x3c
  0000                    M         local   loop
0003A0 0E3C               M         movlw   0x3c
0003A2 6E1A               M         movwf   delayR
                          M 
0003A4                    M loop
0003A4 EC?? F???          M         call    Delay50ms
0003A8 2E1A               M         decfsz  delayR
0003AA EF?? F???          M         goto    loop
0003AE EC?? F???      00634         call    READ_ARDUINO
0003B2 6E2C           00635         movwf   DETECTION_VAL
0003B4 0F30           00636         addlw   0x30
0003B6 EC?? F???      00637         call    WR_DATA
                      00638         Delay50N delayR, 0x3c
  0000                    M         local   loop
0003BA 0E3C               M         movlw   0x3c
0003BC 6E1A               M         movwf   delayR
                          M 
0003BE                    M loop
0003BE EC?? F???          M         call    Delay50ms
0003C2 2E1A               M         decfsz  delayR
0003C4 EF?? F???          M         goto    loop
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00639         
0003C8 D???           00640         bra COLOUR_TEST
                      00641 
                      00642 ;*******************************************************************************
                      00643 ; execution mode
                      00644 ;*******************************************************************************
                      00645         
0003CA                00646 EXECUTION
0003CA 9ED5           00647         bcf     T0CON, TMR0ON       ; turning on timer
0003CC 6A38           00648         clrf    inStandby       
0003CE EC?? F???      00649         call    ClearEEPROM_21
                      00650         
                      00651         ; save the starting time
0003D2 EC?? F???      00652         call        SAVE_TIME
                      00653                 
                      00654         ; display
0003D6 681E           00655         setf        inExecution
0003D8 EC?? F???      00656         call        ClrLCD
                      00657         Display     Exe1
  0000                    M         local   loop
0003DC 0E??               M         movlw   upper Exe1      ; Move Table<20:16>
0003DE 6EF8               M         movwf   TBLPTRU
0003E0 0E??               M         movlw   high Exe1       ; Move Table<15:8>
0003E2 6EF7               M         movwf   TBLPTRH
0003E4 0E??               M         movlw   low Exe1        ; Move Table<7:0>
0003E6 6EF6               M         movwf   TBLPTRL
0003E8 0008               M         tblrd*                  ; Read byte from TBLPTRL to TABLAT
0003EA 50F5               M         movf    TABLAT, W
0003EC                    M loop
0003EC EC?? F???          M         call    WR_DATA         ; write to LCD
0003F0 000B               M         tblrd+*                 ; next row in table
0003F2 50F5               M         movf    TABLAT, W
0003F4 E1??               M         bnz     loop
0003F6 EC?? F???      00658         call        LCD_L2
                      00659         
0003FA 0EC3           00660         movlw   0xc3
0003FC 6ED7           00661         movwf   TMR0H
0003FE 0E25           00662         movlw   0x25
000400 6ED6           00663         movwf   TMR0L
                      00664         
000402 8ED5           00665         bsf         T0CON, TMR0ON           ; turning on timer
                      00666         
                      00667         ; initialize variables
000404 6A18           00668         clrf        OP_sec
000406 6A19           00669         clrf        OP_INT
                      00670         
000408 6A2D           00671         clrf        ESKA
00040A 6A2E           00672         clrf        ESKA_NOCAP
00040C 6A2F           00673         clrf        YOP
00040E 6A30           00674         clrf        YOP_NOCAP
000410 6A31           00675         clrf        TOTAL_BOTTLES
000412 0E01           00676         movlw       d'1'
000414 6E35           00677         movwf       TRAY_CURRENT
000416 6A34           00678         clrf        TRAY_DELAY
                      00679         
000418 0E01           00680         movlw   b'00000001'
00041A 6E84           00681         movwf   PORTE
                      00682         
                      00683         ; todo: make sure tray is in position one on reset, add some delay
                      00684         
00041C EF?? F???      00685         goto        DETECTIONS
                      00686 
000420                00687 COLLECTIONS_CORRECTION
000420 0E00           00688         movlw       d'0'
000422 6E33           00689         movwf       TRAY_COUNT
                      00690         
000424 0E1A           00691         movlw       d'26'
000426 6E34           00692         movwf       TRAY_DELAY
000428 D???           00693         bra         ROTATE_45
                      00694         
00042A                00695 COLLECTIONS_VALUE
00042A 0E01           00696         movlw       d'1'
00042C 6E33           00697         movwf       TRAY_COUNT
                      00698         
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 17


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00042E 0E19           00699         movlw       d'25'
000430 6E34           00700         movwf       TRAY_DELAY
000432 D???           00701         bra         ROTATE_45
                      00702         
000434                00703 COLLECTIONS_STEP
000434 6A32           00704         clrf        COLLECTIONS_COUNT
000436 0E00           00705         movlw       d'0'
                      00706 ;       cpfseq      TRAY_COUNT
                      00707 ;       bra         COLLECTIONS_CORRECTION
                      00708 ;       bra         COLLECTIONS_VALUE
                      00709         Delay50N    delayR, 0x14
  0000                    M         local   loop
000438 0E14               M         movlw   0x14
00043A 6E1A               M         movwf   delayR
                          M 
00043C                    M loop
00043C EC?? F???          M         call    Delay50ms
000440 2E1A               M         decfsz  delayR
000442 EF?? F???          M         goto    loop
                      00710 
                      00711 
000446                00712 ROTATE_45                       ; count needs to be 25 for 45 (45/1.8=25)
000446 0E23           00713         movlw   b'00100011'
000448 6E80           00714         movwf   PORTA
                      00715         Delay50N    delayR, 0x03
  0000                    M         local   loop
00044A 0E03               M         movlw   0x03
00044C 6E1A               M         movwf   delayR
                          M 
00044E                    M loop
00044E EC?? F???          M         call    Delay50ms
000452 2E1A               M         decfsz  delayR
000454 EF?? F???          M         goto    loop
000458 2A32           00716         incf    COLLECTIONS_COUNT
                      00717         
00045A C034 FFE8      00718         movff   TRAY_DELAY, WREG
00045E 0E19           00719         movlw   d'25'
000460 5C32           00720         subwf   COLLECTIONS_COUNT, 0
000462 E0??           00721         bz      DETECTIONS
                      00722 
000464 0E26           00723         movlw   b'00100110'
000466 6E80           00724         movwf   PORTA
                      00725         Delay50N    delayR, 0x03
  0000                    M         local   loop
000468 0E03               M         movlw   0x03
00046A 6E1A               M         movwf   delayR
                          M 
00046C                    M loop
00046C EC?? F???          M         call    Delay50ms
000470 2E1A               M         decfsz  delayR
000472 EF?? F???          M         goto    loop
000476 2A32           00726         incf    COLLECTIONS_COUNT
                      00727         
                      00728 ;       movff   TRAY_DELAY, WREG
                      00729 ;       subwf   COLLECTIONS_COUNT, 0
                      00730 ;       bz      DETECTIONS
                      00731         
000478 0E2C           00732         movlw   b'00101100'
00047A 6E80           00733         movwf   PORTA
                      00734         Delay50N    delayR, 0x03
  0000                    M         local   loop
00047C 0E03               M         movlw   0x03
00047E 6E1A               M         movwf   delayR
                          M 
000480                    M loop
000480 EC?? F???          M         call    Delay50ms
000484 2E1A               M         decfsz  delayR
000486 EF?? F???          M         goto    loop
00048A 2A32           00735         incf    COLLECTIONS_COUNT
                      00736         
                      00737 ;       movff   TRAY_DELAY, WREG
                      00738 ;       subwf   COLLECTIONS_COUNT, 0
                      00739 ;       bz      DETECTIONS
                      00740 
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 18


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00048C 0E29           00741         movlw   b'00101001'
00048E 6E80           00742         movwf   PORTA
                      00743         Delay50N    delayR, 0x03
  0000                    M         local   loop
000490 0E03               M         movlw   0x03
000492 6E1A               M         movwf   delayR
                          M 
000494                    M loop
000494 EC?? F???          M         call    Delay50ms
000498 2E1A               M         decfsz  delayR
00049A EF?? F???          M         goto    loop
00049E 2A32           00744         incf    COLLECTIONS_COUNT
                      00745         
                      00746 ;       movff   TRAY_DELAY, WREG
                      00747 ;       subwf   COLLECTIONS_COUNT, 0
                      00748 ;       bz      DETECTIONS
0004A0 EF?? F???      00749         goto    ROTATE_45
                      00750         
0004A4                00751 DETECTIONS
                      00752         ; reading data from arduino 
                      00753         ; expect:   1 for eska cap
                      00754         ;           2 for eska no cap
                      00755         ;           3 for yop cap
                      00756         ;           4 for yop no cap
                      00757         ;           5 for no bottle, get outta here
                      00758         Delay50N delayR, 0x3c
  0000                    M         local   loop
0004A4 0E3C               M         movlw   0x3c
0004A6 6E1A               M         movwf   delayR
                          M 
0004A8                    M loop
0004A8 EC?? F???          M         call    Delay50ms
0004AC 2E1A               M         decfsz  delayR
0004AE EF?? F???          M         goto    loop
0004B2 EC?? F???      00759         call    READ_ARDUINO
0004B6 6E2C           00760         movwf   DETECTION_VAL
                      00761         
                      00762         ; first check if there was a bottle detected, if so go to COLLECTIONS_STEP
0004B8 0E05           00763         movlw   d'5'
0004BA 5C2C           00764         subwf   DETECTION_VAL, 0
0004BC E0??           00765         bz      COLLECTIONS_STEP
                      00766         
                      00767         ; okay we have a bottle, first increment total count then see what it is
0004BE 2A31           00768         incf    TOTAL_BOTTLES
                      00769         
                      00770         ; yop no cap
0004C0 0E04           00771         movlw   d'4'
0004C2 5C2C           00772         subwf   DETECTION_VAL, 0
0004C4 E0??           00773         bz      INC_YOPNOCAP
                      00774         
                      00775         ; yop with cap
0004C6 0E03           00776         movlw   d'3'
0004C8 5C2C           00777         subwf   DETECTION_VAL, 0
0004CA E0??           00778         bz      INC_YOPCAP
                      00779         
                      00780         ; eska no cap
0004CC 0E02           00781         movlw   d'2'
0004CE 5C2C           00782         subwf   DETECTION_VAL, 0
0004D0 E0??           00783         bz      INC_ESKANOCAP
                      00784         
                      00785         ; eksa with cap
0004D2 0E01           00786         movlw   d'1'
0004D4 5C2C           00787         subwf   DETECTION_VAL, 0
0004D6 E0??           00788         bz      INC_ESKACAP
                      00789         
                      00790         ; edge case, cant determine bottle so check if done sorting
0004D8 D???           00791         bra     CHECK_DONE
                      00792         
0004DA                00793 INC_YOPNOCAP
0004DA 2A30           00794         incf    YOP_NOCAP
0004DC D???           00795         bra     CHECK_DONE
                      00796         
0004DE                00797 INC_YOPCAP
0004DE 2A2F           00798         incf    YOP
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 19


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0004E0 D???           00799         bra     CHECK_DONE
                      00800         
0004E2                00801 INC_ESKANOCAP
0004E2 2A2E           00802         incf    ESKA_NOCAP
0004E4 D???           00803         bra     CHECK_DONE
                      00804         
0004E6                00805 INC_ESKACAP
0004E6 2A2D           00806         incf    ESKA
0004E8 D???           00807         bra     CHECK_DONE
                      00808         
0004EA                00809 CHECK_DONE
                      00810         ; Challenging:  logic to figure out when the machine is done sorting 
                      00811         ;               if the TOTAL_BOTTLES count is less than 10. 
                      00812         
                      00813         ; OPTIMAL/MAX QUALIFIED TIME: 
                      00814         ; if the execution time exceeds the optimal threshold of 120s, check for 
                      00815         ; qualified run and then stop. if the time exceeds the max threshold of 
                      00816         ; 150s then stop.
0004EA 3818           00817         swapf   OP_sec, 0       ; 100's seconds
0004EC 6E17           00818         movwf   temp
0004EE 0E0F           00819         movlw   0x0f
0004F0 1617           00820         andwf   temp
0004F2 0E00           00821         movlw   d'0'
0004F4 6417           00822         cpfsgt  temp
0004F6 EF?? F???      00823         goto    DETECTIONS      ; if 100 second, continue to check for 150s then 120s.
                      00824 
                      00825         ; MAX
0004FA 0E02           00826         movlw   d'2'
0004FC 6E37           00827         movwf   STOP_CONDITION  ; timeout stop, saved in eeprom as 2
0004FE C018 F017      00828         movff   OP_sec, temp    ; 10's seconds
000502 0E0F           00829         movlw   0x0f
000504 1617           00830         andwf   temp
000506 0E05           00831         movlw   d'5'
000508 5C17           00832         subwf   temp, 0
00050A E0??           00833         bz      EXIT_EXE        ; if 150 second, terminate
                      00834         
                      00835         ; NUMBER: 
                      00836         ; if the total bottle count is 10, then we are done (most basic end condition)
00050C 6A37           00837         clrf    STOP_CONDITION  ; denote regular stop, saved in eeprom as 0
00050E 0E0A           00838         movlw   d'10'
000510 5C31           00839         subwf   TOTAL_BOTTLES, 0
000512 E0??           00840         bz      EXIT_EXE
                      00841         
                      00842         ; here we know that bottles < 10 and 100 < time < 150, so check for qualified run
                      00843         ; qualified run has at least 4 bottles, with 1 of each different kind
000514 0E03           00844         movlw   d'3'
000516 6431           00845         cpfsgt  TOTAL_BOTTLES
000518 EF?? F???      00846         goto    DETECTIONS
                      00847 
00051C 0E00           00848         movlw   d'0'
00051E 6430           00849         cpfsgt  YOP_NOCAP, 0
000520 EF?? F???      00850         goto    DETECTIONS
                      00851         
000524 0E00           00852         movlw   d'0'
000526 642F           00853         cpfsgt  YOP, 0
000528 EF?? F???      00854         goto    DETECTIONS
                      00855         
00052C 0E00           00856         movlw   d'0'
00052E 642E           00857         cpfsgt  ESKA_NOCAP, 0
000530 EF?? F???      00858         goto    DETECTIONS
                      00859         
000534 0E00           00860         movlw   d'0'
000536 642D           00861         cpfsgt  ESKA, 0
000538 EF?? F???      00862         goto    DETECTIONS
                      00863         
                      00864         ; finally, if we get here then consider the termination optimized.
00053C 0E03           00865         movlw   d'3'
00053E 6E37           00866         movwf   STOP_CONDITION  ; optimized stop, saved in eeprom as 3
000540 EF?? F???      00867         goto    EXIT_EXE
                      00868         
000544                00869 EXIT_EXE
                      00870         ; stop timer and save the execution time to eeprom
000544 9ED5           00871         bcf         T0CON, TMR0ON
000546 EC?? F???      00872         call        SAVE_EXE_TIME
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 20


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00873                 
                      00874         ; Clear inExecution flag to stop '*' interrupts
00054A 6A1E           00875         clrf        inExecution
                      00876         
00054C EC?? F???      00877         call        ClrLCD
                      00878         Display     SAVE
  0000                    M         local   loop
000550 0E??               M         movlw   upper SAVE      ; Move Table<20:16>
000552 6EF8               M         movwf   TBLPTRU
000554 0E??               M         movlw   high SAVE       ; Move Table<15:8>
000556 6EF7               M         movwf   TBLPTRH
000558 0E??               M         movlw   low SAVE        ; Move Table<7:0>
00055A 6EF6               M         movwf   TBLPTRL
00055C 0008               M         tblrd*                  ; Read byte from TBLPTRL to TABLAT
00055E 50F5               M         movf    TABLAT, W
000560                    M loop
000560 EC?? F???          M         call    WR_DATA         ; write to LCD
000564 000B               M         tblrd+*                 ; next row in table
000566 50F5               M         movf    TABLAT, W
000568 E1??               M         bnz     loop
00056A EC?? F???      00879         call        SaveData
00056E EF?? F???      00880         goto        LOG
                      00881 
                      00882 ;*******************************************************************************
                      00883 ; sorting statistics log mode
                      00884 ;*******************************************************************************
                      00885         
000572                00886 LOG
000572 6A38           00887         clrf    inStandby
000574 EC?? F???      00888         call    ClrLCD
                      00889         Display Log1
  0000                    M         local   loop
000578 0E??               M         movlw   upper Log1      ; Move Table<20:16>
00057A 6EF8               M         movwf   TBLPTRU
00057C 0E??               M         movlw   high Log1       ; Move Table<15:8>
00057E 6EF7               M         movwf   TBLPTRH
000580 0E??               M         movlw   low Log1        ; Move Table<7:0>
000582 6EF6               M         movwf   TBLPTRL
000584 0008               M         tblrd*                  ; Read byte from TBLPTRL to TABLAT
000586 50F5               M         movf    TABLAT, W
000588                    M loop
000588 EC?? F???          M         call    WR_DATA         ; write to LCD
00058C 000B               M         tblrd+*                 ; next row in table
00058E 50F5               M         movf    TABLAT, W
000590 E1??               M         bnz     loop
                      00890 
                      00891         ; display most recent run data
000592 0E0A           00892         movlw   d'10'
000594 6E21           00893         movwf   L_EE
000596 EC?? F???      00894         call    DisplayExeTime
                      00895 
00059A EC?? F???      00896         call    LCD_L2
00059E 0E0D           00897         movlw   d'13'               ; sorting stats begin at bit 14 in eeprom
0005A0 6E21           00898         movwf   L_EE
0005A2 EC?? F???      00899         call    DispOpSort
                      00900 
0005A6                00901 HOLD_LOG
0005A6 EC?? F???      00902         call    READ_KEY
                      00903         ChangeMode  keyB, LOG_INFO
  0000                    M         local Next, Exit
                          M 
0005AA 0E07               M         movlw   keyB                ; poll for mode
0005AC 6210               M         cpfseq  KEY                 ; check this against key press
0005AE EF?? F???          M         goto    Exit
                          M 
0005B2                    M Next
0005B2 6A89               M         clrf    LATA                ; clear pins before proceeding
0005B4 6A8A               M         clrf    LATB
0005B6 6A8B               M         clrf    LATC
0005B8 6A8C               M         clrf    LATD
0005BA EF?? F???          M         goto    LOG_INFO
                          M 
0005BE                    M Exit
0005BE 0000               M         nop
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 21


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00904         ChangeMode  key0, STANDBY
  0000                    M         local Next, Exit
                          M 
0005C0 0E0D               M         movlw   key0                ; poll for mode
0005C2 6210               M         cpfseq  KEY                 ; check this against key press
0005C4 EF?? F???          M         goto    Exit
                          M 
0005C8                    M Next
0005C8 6A89               M         clrf    LATA                ; clear pins before proceeding
0005CA 6A8A               M         clrf    LATB
0005CC 6A8B               M         clrf    LATC
0005CE 6A8C               M         clrf    LATD
0005D0 EF?? F???          M         goto    STANDBY
                          M 
0005D4                    M Exit
0005D4 0000               M         nop
0005D6 D???           00905         bra     HOLD_LOG
                      00906 
0005D8                00907 LOG_INFO
0005D8 EC?? F???      00908         call    ClrLCD
0005DC 6A21           00909         clrf    L_EE
0005DE EC?? F???      00910         call    DispOpRTC
                      00911         
0005E2 EC?? F???      00912         call    LCD_L2
                      00913         Display LogInfo2
  0000                    M         local   loop
0005E6 0E??               M         movlw   upper LogInfo2  ; Move Table<20:16>
0005E8 6EF8               M         movwf   TBLPTRU
0005EA 0E??               M         movlw   high LogInfo2   ; Move Table<15:8>
0005EC 6EF7               M         movwf   TBLPTRH
0005EE 0E??               M         movlw   low LogInfo2    ; Move Table<7:0>
0005F0 6EF6               M         movwf   TBLPTRL
0005F2 0008               M         tblrd*                  ; Read byte from TBLPTRL to TABLAT
0005F4 50F5               M         movf    TABLAT, W
0005F6                    M loop
0005F6 EC?? F???          M         call    WR_DATA         ; write to LCD
0005FA 000B               M         tblrd+*                 ; next row in table
0005FC 50F5               M         movf    TABLAT, W
0005FE E1??               M         bnz     loop
000600 6A20           00914         clrf    H_EE
000602 6A21           00915         clrf    L_EE
000604                00916 HOLD_LOG_INFO
000604 EC?? F???      00917         call    READ_KEY
                      00918         ChangeMode key0, LOG
  0000                    M         local Next, Exit
                          M 
000608 0E0D               M         movlw   key0                ; poll for mode
00060A 6210               M         cpfseq  KEY                 ; check this against key press
00060C EF?? F???          M         goto    Exit
                          M 
000610                    M Next
000610 6A89               M         clrf    LATA                ; clear pins before proceeding
000612 6A8A               M         clrf    LATB
000614 6A8B               M         clrf    LATC
000616 6A8C               M         clrf    LATD
000618 EF?? F???          M         goto    LOG
                          M 
00061C                    M Exit
00061C 0000               M         nop
00061E D???           00919         bra     HOLD_LOG
                      00920         
                      00921 ;*******************************************************************************
                      00922 ; permanent logs
                      00923 ;*******************************************************************************
                      00924 
000620                00925 PERM_LOG
000620 6A38           00926         clrf    inStandby
000622 EC?? F???      00927         call    ClrLCD
                      00928         Display PermLog1
  0000                    M         local   loop
000626 0E??               M         movlw   upper PermLog1  ; Move Table<20:16>
000628 6EF8               M         movwf   TBLPTRU
00062A 0E??               M         movlw   high PermLog1   ; Move Table<15:8>
00062C 6EF7               M         movwf   TBLPTRH
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 22


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00062E 0E??               M         movlw   low PermLog1    ; Move Table<7:0>
000630 6EF6               M         movwf   TBLPTRL
000632 0008               M         tblrd*                  ; Read byte from TBLPTRL to TABLAT
000634 50F5               M         movf    TABLAT, W
000636                    M loop
000636 EC?? F???          M         call    WR_DATA         ; write to LCD
00063A 000B               M         tblrd+*                 ; next row in table
00063C 50F5               M         movf    TABLAT, W
00063E E1??               M         bnz     loop
000640 EC?? F???      00929         call    LCD_L2
                      00930         Display PermLog2
  0000                    M         local   loop
000644 0E??               M         movlw   upper PermLog2  ; Move Table<20:16>
000646 6EF8               M         movwf   TBLPTRU
000648 0E??               M         movlw   high PermLog2   ; Move Table<15:8>
00064A 6EF7               M         movwf   TBLPTRH
00064C 0E??               M         movlw   low PermLog2    ; Move Table<7:0>
00064E 6EF6               M         movwf   TBLPTRL
000650 0008               M         tblrd*                  ; Read byte from TBLPTRL to TABLAT
000652 50F5               M         movf    TABLAT, W
000654                    M loop
000654 EC?? F???          M         call    WR_DATA         ; write to LCD
000658 000B               M         tblrd+*                 ; next row in table
00065A 50F5               M         movf    TABLAT, W
00065C E1??               M         bnz     loop
                      00931         
00065E                00932 HOLD_PERM_LOG
00065E EC?? F???      00933         call    READ_KEY
                      00934         ChangeMode  key0, STANDBY
  0000                    M         local Next, Exit
                          M 
000662 0E0D               M         movlw   key0                ; poll for mode
000664 6210               M         cpfseq  KEY                 ; check this against key press
000666 EF?? F???          M         goto    Exit
                          M 
00066A                    M Next
00066A 6A89               M         clrf    LATA                ; clear pins before proceeding
00066C 6A8A               M         clrf    LATB
00066E 6A8B               M         clrf    LATC
000670 6A8C               M         clrf    LATD
000672 EF?? F???          M         goto    STANDBY
                          M 
000676                    M Exit
000676 0000               M         nop
                      00935         ChangeMode  key1, PLOG
  0000                    M         local Next, Exit
                          M 
000678 0E00               M         movlw   key1                ; poll for mode
00067A 6210               M         cpfseq  KEY                 ; check this against key press
00067C EF?? F???          M         goto    Exit
                          M 
000680                    M Next
000680 6A89               M         clrf    LATA                ; clear pins before proceeding
000682 6A8A               M         clrf    LATB
000684 6A8B               M         clrf    LATC
000686 6A8C               M         clrf    LATD
000688 EF?? F???          M         goto    PLOG
                          M 
00068C                    M Exit
00068C 0000               M         nop
                      00936         ChangeMode  key2, PLOG
  0000                    M         local Next, Exit
                          M 
00068E 0E01               M         movlw   key2                ; poll for mode
000690 6210               M         cpfseq  KEY                 ; check this against key press
000692 EF?? F???          M         goto    Exit
                          M 
000696                    M Next
000696 6A89               M         clrf    LATA                ; clear pins before proceeding
000698 6A8A               M         clrf    LATB
00069A 6A8B               M         clrf    LATC
00069C 6A8C               M         clrf    LATD
00069E EF?? F???          M         goto    PLOG
                          M 
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 23


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

0006A2                    M Exit
0006A2 0000               M         nop
                      00937         ChangeMode  key3, PLOG
  0000                    M         local Next, Exit
                          M 
0006A4 0E02               M         movlw   key3                ; poll for mode
0006A6 6210               M         cpfseq  KEY                 ; check this against key press
0006A8 EF?? F???          M         goto    Exit
                          M 
0006AC                    M Next
0006AC 6A89               M         clrf    LATA                ; clear pins before proceeding
0006AE 6A8A               M         clrf    LATB
0006B0 6A8B               M         clrf    LATC
0006B2 6A8C               M         clrf    LATD
0006B4 EF?? F???          M         goto    PLOG
                          M 
0006B8                    M Exit
0006B8 0000               M         nop
                      00938         ChangeMode  key4, PLOG
  0000                    M         local Next, Exit
                          M 
0006BA 0E04               M         movlw   key4                ; poll for mode
0006BC 6210               M         cpfseq  KEY                 ; check this against key press
0006BE EF?? F???          M         goto    Exit
                          M 
0006C2                    M Next
0006C2 6A89               M         clrf    LATA                ; clear pins before proceeding
0006C4 6A8A               M         clrf    LATB
0006C6 6A8B               M         clrf    LATC
0006C8 6A8C               M         clrf    LATD
0006CA EF?? F???          M         goto    PLOG
                          M 
0006CE                    M Exit
0006CE 0000               M         nop
                      00939         ChangeMode  key5, PLOG
  0000                    M         local Next, Exit
                          M 
0006D0 0E05               M         movlw   key5                ; poll for mode
0006D2 6210               M         cpfseq  KEY                 ; check this against key press
0006D4 EF?? F???          M         goto    Exit
                          M 
0006D8                    M Next
0006D8 6A89               M         clrf    LATA                ; clear pins before proceeding
0006DA 6A8A               M         clrf    LATB
0006DC 6A8B               M         clrf    LATC
0006DE 6A8C               M         clrf    LATD
0006E0 EF?? F???          M         goto    PLOG
                          M 
0006E4                    M Exit
0006E4 0000               M         nop
                      00940         ChangeMode  key6, PLOG
  0000                    M         local Next, Exit
                          M 
0006E6 0E06               M         movlw   key6                ; poll for mode
0006E8 6210               M         cpfseq  KEY                 ; check this against key press
0006EA EF?? F???          M         goto    Exit
                          M 
0006EE                    M Next
0006EE 6A89               M         clrf    LATA                ; clear pins before proceeding
0006F0 6A8A               M         clrf    LATB
0006F2 6A8B               M         clrf    LATC
0006F4 6A8C               M         clrf    LATD
0006F6 EF?? F???          M         goto    PLOG
                          M 
0006FA                    M Exit
0006FA 0000               M         nop
                      00941         ChangeMode  key7, PLOG
  0000                    M         local Next, Exit
                          M 
0006FC 0E08               M         movlw   key7                ; poll for mode
0006FE 6210               M         cpfseq  KEY                 ; check this against key press
000700 EF?? F???          M         goto    Exit
                          M 
000704                    M Next
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 24


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

000704 6A89               M         clrf    LATA                ; clear pins before proceeding
000706 6A8A               M         clrf    LATB
000708 6A8B               M         clrf    LATC
00070A 6A8C               M         clrf    LATD
00070C EF?? F???          M         goto    PLOG
                          M 
000710                    M Exit
000710 0000               M         nop
                      00942         ChangeMode  key8, PLOG
  0000                    M         local Next, Exit
                          M 
000712 0E09               M         movlw   key8                ; poll for mode
000714 6210               M         cpfseq  KEY                 ; check this against key press
000716 EF?? F???          M         goto    Exit
                          M 
00071A                    M Next
00071A 6A89               M         clrf    LATA                ; clear pins before proceeding
00071C 6A8A               M         clrf    LATB
00071E 6A8B               M         clrf    LATC
000720 6A8C               M         clrf    LATD
000722 EF?? F???          M         goto    PLOG
                          M 
000726                    M Exit
000726 0000               M         nop
                      00943         ChangeMode  key9, PLOG
  0000                    M         local Next, Exit
                          M 
000728 0E0A               M         movlw   key9                ; poll for mode
00072A 6210               M         cpfseq  KEY                 ; check this against key press
00072C EF?? F???          M         goto    Exit
                          M 
000730                    M Next
000730 6A89               M         clrf    LATA                ; clear pins before proceeding
000732 6A8A               M         clrf    LATB
000734 6A8B               M         clrf    LATC
000736 6A8C               M         clrf    LATD
000738 EF?? F???          M         goto    PLOG
                          M 
00073C                    M Exit
00073C 0000               M         nop
00073E D???           00944         bra HOLD_PERM_LOG
                      00945         
000740                00946 PLOG
000740 EC?? F???      00947         call    ClrLCD
                      00948         Display PermLog1
  0000                    M         local   loop
000744 0E??               M         movlw   upper PermLog1  ; Move Table<20:16>
000746 6EF8               M         movwf   TBLPTRU
000748 0E??               M         movlw   high PermLog1   ; Move Table<15:8>
00074A 6EF7               M         movwf   TBLPTRH
00074C 0E??               M         movlw   low PermLog1    ; Move Table<7:0>
00074E 6EF6               M         movwf   TBLPTRL
000750 0008               M         tblrd*                  ; Read byte from TBLPTRL to TABLAT
000752 50F5               M         movf    TABLAT, W
000754                    M loop
000754 EC?? F???          M         call    WR_DATA         ; write to LCD
000758 000B               M         tblrd+*                 ; next row in table
00075A 50F5               M         movf    TABLAT, W
00075C E1??               M         bnz     loop
                      00949         
                      00950         ; find the key press value
00075E C010 FFE8      00951         movff   KEY, WREG
000762 2AE8           00952         incf    WREG        ; W = KEY+1
000764 6E17           00953         movwf   temp
                      00954         
000766 42E8           00955         rrncf   WREG        ; division by 4
000768 9EE8           00956         bcf     WREG, 7     ; clear last bit, overflow from rotate
00076A 42E8           00957         rrncf   WREG        
00076C 9EE8           00958         bcf     WREG, 7
00076E 5E17           00959         subwf   temp        ; temp = (KEY+1) - (KEY+1)/4
000770 C017 FFE8      00960         movff   temp, WREG
000774 C017 F011      00961         movff   temp, temp_KEY
000778 0D15           00962         mullw   d'21'       ; indexed as mutliples of 21
                      00963 
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 25


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00077A                00964 displayNum
00077A C011 FFE8      00965         movff   temp_KEY, WREG
00077E 0F30           00966         addlw   0x30
000780 EC?? F???      00967         call    WR_DATA
000784 0E3A           00968         movlw   ":"
000786 EC?? F???      00969         call    WR_DATA
00078A 0E20           00970         movlw   " "
00078C EC?? F???      00971         call    WR_DATA
                      00972         
000790 CFF3 F021      00973         movff   PRODL, L_EE
000794 0E00           00974         movlw   d'0'
000796 2621           00975         addwf   L_EE
                      00976         READEE  OP_sec, H_EE, L_EE
000798 C020 FFAA          M         movff   H_EE, EEADRH        ; read to high
00079C C021 FFA9          M         movff   L_EE, EEADR         ; read to low
0007A0 9EA6               M         bcf     EECON1, EEPGD       ; point to data memory
0007A2 9CA6               M         bcf     EECON1, CFGS        ; access to EEPROM
0007A4 80A6               M         bsf     EECON1, RD          ; read EEPROM
0007A6 CFA8 F018          M         movff   EEDATA, OP_sec      ; put data into file
0007AA 2A21           00977         incf    L_EE
                      00978         READEE  OP_INT, H_EE, L_EE
0007AC C020 FFAA          M         movff   H_EE, EEADRH        ; read to high
0007B0 C021 FFA9          M         movff   L_EE, EEADR         ; read to low
0007B4 9EA6               M         bcf     EECON1, EEPGD       ; point to data memory
0007B6 9CA6               M         bcf     EECON1, CFGS        ; access to EEPROM
0007B8 80A6               M         bsf     EECON1, RD          ; read EEPROM
0007BA CFA8 F019          M         movff   EEDATA, OP_INT      ; put data into file
0007BE 2A21           00979         incf    L_EE
0007C0 EC?? F???      00980         call    DisplayExeTime
0007C4 CFF3 F021      00981         movff   PRODL, L_EE
                      00982         
                      00983         ; reset eeprom to beginning
0007C8 EC?? F???      00984         call    LCD_L2
0007CC CFF3 F021      00985         movff   PRODL, L_EE
0007D0 EC?? F???      00986         call    DispOpRTC
                      00987         
0007D4                00988 HOLD_PLOG
0007D4 EC?? F???      00989         call    READ_KEY
                      00990         ChangeMode  keyA, PLOG_DETAILS
  0000                    M         local Next, Exit
                          M 
0007D8 0E03               M         movlw   keyA                ; poll for mode
0007DA 6210               M         cpfseq  KEY                 ; check this against key press
0007DC EF?? F???          M         goto    Exit
                          M 
0007E0                    M Next
0007E0 6A89               M         clrf    LATA                ; clear pins before proceeding
0007E2 6A8A               M         clrf    LATB
0007E4 6A8B               M         clrf    LATC
0007E6 6A8C               M         clrf    LATD
0007E8 EF?? F???          M         goto    PLOG_DETAILS
                          M 
0007EC                    M Exit
0007EC 0000               M         nop
                      00991         ChangeMode  key0, PERM_LOG      ; back to perm log menu
  0000                    M         local Next, Exit
                          M 
0007EE 0E0D               M         movlw   key0                ; poll for mode
0007F0 6210               M         cpfseq  KEY                 ; check this against key press
0007F2 EF?? F???          M         goto    Exit
                          M 
0007F6                    M Next
0007F6 6A89               M         clrf    LATA                ; clear pins before proceeding
0007F8 6A8A               M         clrf    LATB
0007FA 6A8B               M         clrf    LATC
0007FC 6A8C               M         clrf    LATD
0007FE EF?? F???          M         goto    PERM_LOG
                          M 
000802                    M Exit
000802 0000               M         nop
000804 D???           00992         bra HOLD_PLOG
                      00993         
000806                00994 PLOG_DETAILS
000806 EC?? F???      00995         call    ClrLCD
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 26


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      00996         
                      00997         Display Log1
  0000                    M         local   loop
00080A 0E??               M         movlw   upper Log1      ; Move Table<20:16>
00080C 6EF8               M         movwf   TBLPTRU
00080E 0E??               M         movlw   high Log1       ; Move Table<15:8>
000810 6EF7               M         movwf   TBLPTRH
000812 0E??               M         movlw   low Log1        ; Move Table<7:0>
000814 6EF6               M         movwf   TBLPTRL
000816 0008               M         tblrd*                  ; Read byte from TBLPTRL to TABLAT
000818 50F5               M         movf    TABLAT, W
00081A                    M loop
00081A EC?? F???          M         call    WR_DATA         ; write to LCD
00081E 000B               M         tblrd+*                 ; next row in table
000820 50F5               M         movf    TABLAT, W
000822 E1??               M         bnz     loop
000824 EC?? F???      00998         call    DisplayExeTime
                      00999         
000828 EC?? F???      01000         call    LCD_L2
00082C EC?? F???      01001         call    DispOpSort
                      01002         
000830                01003 HOLD_PLOG_DETAILS
000830 EC?? F???      01004         call    READ_KEY
                      01005         ChangeMode  key0, PERM_LOG      ; back to perm log menu
  0000                    M         local Next, Exit
                          M 
000834 0E0D               M         movlw   key0                ; poll for mode
000836 6210               M         cpfseq  KEY                 ; check this against key press
000838 EF?? F???          M         goto    Exit
                          M 
00083C                    M Next
00083C 6A89               M         clrf    LATA                ; clear pins before proceeding
00083E 6A8A               M         clrf    LATB
000840 6A8B               M         clrf    LATC
000842 6A8C               M         clrf    LATD
000844 EF?? F???          M         goto    PERM_LOG
                          M 
000848                    M Exit
000848 0000               M         nop
00084A D???           01006         bra HOLD_PLOG_DETAILS
                      01007         
                      01008 ;*******************************************************************************
                      01009 ; pc interface
                      01010 ;*******************************************************************************
                      01011 
00084C                01012 PC_MODE
00084C 6A38           01013         clrf    inStandby
00084E EC?? F???      01014         call    ClrLCD
                      01015         Display PC1
  0000                    M         local   loop
000852 0E??               M         movlw   upper PC1       ; Move Table<20:16>
000854 6EF8               M         movwf   TBLPTRU
000856 0E??               M         movlw   high PC1        ; Move Table<15:8>
000858 6EF7               M         movwf   TBLPTRH
00085A 0E??               M         movlw   low PC1         ; Move Table<7:0>
00085C 6EF6               M         movwf   TBLPTRL
00085E 0008               M         tblrd*                  ; Read byte from TBLPTRL to TABLAT
000860 50F5               M         movf    TABLAT, W
000862                    M loop
000862 EC?? F???          M         call    WR_DATA         ; write to LCD
000866 000B               M         tblrd+*                 ; next row in table
000868 50F5               M         movf    TABLAT, W
00086A E1??               M         bnz     loop
00086C EC?? F???      01016         call    LCD_L2
                      01017         Display PC2
  0000                    M         local   loop
000870 0E??               M         movlw   upper PC2       ; Move Table<20:16>
000872 6EF8               M         movwf   TBLPTRU
000874 0E??               M         movlw   high PC2        ; Move Table<15:8>
000876 6EF7               M         movwf   TBLPTRH
000878 0E??               M         movlw   low PC2         ; Move Table<7:0>
00087A 6EF6               M         movwf   TBLPTRL
00087C 0008               M         tblrd*                  ; Read byte from TBLPTRL to TABLAT
00087E 50F5               M         movf    TABLAT, W
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 27


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

000880                    M loop
000880 EC?? F???          M         call    WR_DATA         ; write to LCD
000884 000B               M         tblrd+*                 ; next row in table
000886 50F5               M         movf    TABLAT, W
000888 E1??               M         bnz     loop
00088A CFF9 F029      01018         movff   PCL, PC_PCL
00088E CFFA F02A      01019         movff   PCLATH, PC_PCLATH
000892 CFFB F02B      01020         movff   PCLATU, PC_PCLATU
                      01021         
000896                01022 HOLD_PC
000896 EC?? F???      01023         call    READ_KEY
                      01024         ChangeMode  key0, STANDBY
  0000                    M         local Next, Exit
                          M 
00089A 0E0D               M         movlw   key0                ; poll for mode
00089C 6210               M         cpfseq  KEY                 ; check this against key press
00089E EF?? F???          M         goto    Exit
                          M 
0008A2                    M Next
0008A2 6A89               M         clrf    LATA                ; clear pins before proceeding
0008A4 6A8A               M         clrf    LATB
0008A6 6A8B               M         clrf    LATC
0008A8 6A8C               M         clrf    LATD
0008AA EF?? F???          M         goto    STANDBY
                          M 
0008AE                    M Exit
0008AE 0000               M         nop
                      01025         ChangeMode  keyH, PC_TRANSFER
  0000                    M         local Next, Exit
                          M 
0008B0 0E0E               M         movlw   keyH                ; poll for mode
0008B2 6210               M         cpfseq  KEY                 ; check this against key press
0008B4 EF?? F???          M         goto    Exit
                          M 
0008B8                    M Next
0008B8 6A89               M         clrf    LATA                ; clear pins before proceeding
0008BA 6A8A               M         clrf    LATB
0008BC 6A8B               M         clrf    LATC
0008BE 6A8C               M         clrf    LATD
0008C0 EF?? F???          M         goto    PC_TRANSFER
                          M 
0008C4                    M Exit
0008C4 0000               M         nop
0008C6 D???           01026         bra     HOLD_PC
                      01027 
0008C8                01028 PC_TRANSFER
0008C8 6828           01029         setf    transferring
0008CA EC?? F???      01030         call    ClrLCD
                      01031         Display PCTransfer
  0000                    M         local   loop
0008CE 0E??               M         movlw   upper PCTransfer ; Move Table<20:16>
0008D0 6EF8               M         movwf   TBLPTRU
0008D2 0E??               M         movlw   high PCTransfer ; Move Table<15:8>
0008D4 6EF7               M         movwf   TBLPTRH
0008D6 0E??               M         movlw   low PCTransfer  ; Move Table<7:0>
0008D8 6EF6               M         movwf   TBLPTRL
0008DA 0008               M         tblrd*                  ; Read byte from TBLPTRL to TABLAT
0008DC 50F5               M         movf    TABLAT, W
0008DE                    M loop
0008DE EC?? F???          M         call    WR_DATA         ; write to LCD
0008E2 000B               M         tblrd+*                 ; next row in table
0008E4 50F5               M         movf    TABLAT, W
0008E6 E1??               M         bnz     loop
0008E8 EC?? F???      01032         call    DataUSART
0008EC 6A28           01033         clrf    transferring
0008EE EF?? F???      01034         goto    STANDBY
                      01035         
                      01036 ;*******************************************************************************
                      01037 ; subroutines
                      01038 ;*******************************************************************************
                      01039 
0008F2                01040 SaveData
0008F2 C02D FFE8      01041         movff       ESKA, WREG
0008F6 0F30           01042         addlw       0x30
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 28


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01043         WriteEE     WREG, H_EE, L_EE
0008F8 C020 FFAA          M         movff   H_EE, EEADRH        ; High address
0008FC C021 FFA9          M         movff   L_EE, EEADR         ; Low address
000900 CFE8 FFA8          M         movff   WREG, EEDATA        ; set word
                          M 
000904 B2A6               M         btfsc   EECON1, WR          ; test if WR=0, skip if so
000906 D???               M         bra     $-2
                          M 
000908 9EA6               M         bcf     EECON1, EEPGD       ; Point to data memory
00090A 9CA6               M         bcf     EECON1, CFGS        ; Access EEPROM
00090C 84A6               M         bsf     EECON1, WREN        ; enable write
00090E 9EF2               M         bcf     INTCON, GIE         ; disable interrupts during write
000910 98A1               M         bcf     PIR2, EEIF
                          M 
000912 0E55               M         movlw   0x55
000914 6EA7               M         movwf   EECON2              ; write 55h
000916 0EAA               M         movlw   0xaa
000918 6EA7               M         movwf   EECON2              ; write 0xaa
00091A 82A6               M         bsf     EECON1, WR          ; begin write
00091C B2A6               M         btfsc   EECON1, WR
00091E D???               M         bra     $-2
                          M 
000920 8EF2               M         bsf     INTCON, GIE         ; enable interrupts after write
000922 94A6               M         bcf     EECON1, WREN        ; disable writes
000924 2A21           01044         incf        L_EE
                      01045         
000926 C02E FFE8      01046         movff       ESKA_NOCAP, WREG
00092A 0F30           01047         addlw       0x30
                      01048         WriteEE     WREG, H_EE, L_EE
00092C C020 FFAA          M         movff   H_EE, EEADRH        ; High address
000930 C021 FFA9          M         movff   L_EE, EEADR         ; Low address
000934 CFE8 FFA8          M         movff   WREG, EEDATA        ; set word
                          M 
000938 B2A6               M         btfsc   EECON1, WR          ; test if WR=0, skip if so
00093A D???               M         bra     $-2
                          M 
00093C 9EA6               M         bcf     EECON1, EEPGD       ; Point to data memory
00093E 9CA6               M         bcf     EECON1, CFGS        ; Access EEPROM
000940 84A6               M         bsf     EECON1, WREN        ; enable write
000942 9EF2               M         bcf     INTCON, GIE         ; disable interrupts during write
000944 98A1               M         bcf     PIR2, EEIF
                          M 
000946 0E55               M         movlw   0x55
000948 6EA7               M         movwf   EECON2              ; write 55h
00094A 0EAA               M         movlw   0xaa
00094C 6EA7               M         movwf   EECON2              ; write 0xaa
00094E 82A6               M         bsf     EECON1, WR          ; begin write
000950 B2A6               M         btfsc   EECON1, WR
000952 D???               M         bra     $-2
                          M 
000954 8EF2               M         bsf     INTCON, GIE         ; enable interrupts after write
000956 94A6               M         bcf     EECON1, WREN        ; disable writes
000958 2A21           01049         incf        L_EE
                      01050         
00095A C02F FFE8      01051         movff       YOP, WREG
00095E 0F30           01052         addlw       0x30
                      01053         WriteEE     WREG, H_EE, L_EE
000960 C020 FFAA          M         movff   H_EE, EEADRH        ; High address
000964 C021 FFA9          M         movff   L_EE, EEADR         ; Low address
000968 CFE8 FFA8          M         movff   WREG, EEDATA        ; set word
                          M 
00096C B2A6               M         btfsc   EECON1, WR          ; test if WR=0, skip if so
00096E D???               M         bra     $-2
                          M 
000970 9EA6               M         bcf     EECON1, EEPGD       ; Point to data memory
000972 9CA6               M         bcf     EECON1, CFGS        ; Access EEPROM
000974 84A6               M         bsf     EECON1, WREN        ; enable write
000976 9EF2               M         bcf     INTCON, GIE         ; disable interrupts during write
000978 98A1               M         bcf     PIR2, EEIF
                          M 
00097A 0E55               M         movlw   0x55
00097C 6EA7               M         movwf   EECON2              ; write 55h
00097E 0EAA               M         movlw   0xaa
000980 6EA7               M         movwf   EECON2              ; write 0xaa
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 29


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

000982 82A6               M         bsf     EECON1, WR          ; begin write
000984 B2A6               M         btfsc   EECON1, WR
000986 D???               M         bra     $-2
                          M 
000988 8EF2               M         bsf     INTCON, GIE         ; enable interrupts after write
00098A 94A6               M         bcf     EECON1, WREN        ; disable writes
00098C 2A21           01054         incf        L_EE
                      01055         
00098E C030 FFE8      01056         movff       YOP_NOCAP, WREG
000992 0F30           01057         addlw       0x30
                      01058         WriteEE     WREG, H_EE, L_EE
000994 C020 FFAA          M         movff   H_EE, EEADRH        ; High address
000998 C021 FFA9          M         movff   L_EE, EEADR         ; Low address
00099C CFE8 FFA8          M         movff   WREG, EEDATA        ; set word
                          M 
0009A0 B2A6               M         btfsc   EECON1, WR          ; test if WR=0, skip if so
0009A2 D???               M         bra     $-2
                          M 
0009A4 9EA6               M         bcf     EECON1, EEPGD       ; Point to data memory
0009A6 9CA6               M         bcf     EECON1, CFGS        ; Access EEPROM
0009A8 84A6               M         bsf     EECON1, WREN        ; enable write
0009AA 9EF2               M         bcf     INTCON, GIE         ; disable interrupts during write
0009AC 98A1               M         bcf     PIR2, EEIF
                          M 
0009AE 0E55               M         movlw   0x55
0009B0 6EA7               M         movwf   EECON2              ; write 55h
0009B2 0EAA               M         movlw   0xaa
0009B4 6EA7               M         movwf   EECON2              ; write 0xaa
0009B6 82A6               M         bsf     EECON1, WR          ; begin write
0009B8 B2A6               M         btfsc   EECON1, WR
0009BA D???               M         bra     $-2
                          M 
0009BC 8EF2               M         bsf     INTCON, GIE         ; enable interrupts after write
0009BE 94A6               M         bcf     EECON1, WREN        ; disable writes
0009C0 2A21           01059         incf        L_EE
                      01060         
0009C2 C037 FFE8      01061         movff       STOP_CONDITION, WREG
0009C6 0F30           01062         addlw       0x30
                      01063         WriteEE     WREG, H_EE, L_EE
0009C8 C020 FFAA          M         movff   H_EE, EEADRH        ; High address
0009CC C021 FFA9          M         movff   L_EE, EEADR         ; Low address
0009D0 CFE8 FFA8          M         movff   WREG, EEDATA        ; set word
                          M 
0009D4 B2A6               M         btfsc   EECON1, WR          ; test if WR=0, skip if so
0009D6 D???               M         bra     $-2
                          M 
0009D8 9EA6               M         bcf     EECON1, EEPGD       ; Point to data memory
0009DA 9CA6               M         bcf     EECON1, CFGS        ; Access EEPROM
0009DC 84A6               M         bsf     EECON1, WREN        ; enable write
0009DE 9EF2               M         bcf     INTCON, GIE         ; disable interrupts during write
0009E0 98A1               M         bcf     PIR2, EEIF
                          M 
0009E2 0E55               M         movlw   0x55
0009E4 6EA7               M         movwf   EECON2              ; write 55h
0009E6 0EAA               M         movlw   0xaa
0009E8 6EA7               M         movwf   EECON2              ; write 0xaa
0009EA 82A6               M         bsf     EECON1, WR          ; begin write
0009EC B2A6               M         btfsc   EECON1, WR
0009EE D???               M         bra     $-2
                          M 
0009F0 8EF2               M         bsf     INTCON, GIE         ; enable interrupts after write
0009F2 94A6               M         bcf     EECON1, WREN        ; disable writes
0009F4 2A21           01064         incf        L_EE
                      01065         
0009F6 0E00           01066         movlw       d'0'
0009F8 6E20           01067         movwf       H_EE
0009FA 0EA8           01068         movlw       d'168'              ; take d'168' as last
0009FC 6E21           01069         movwf       L_EE
0009FE 0E00           01070         movlw       d'0'
000A00 6E23           01071         movwf       tempH_EE
000A02 0EDC           01072         movlw       d'220'              ; temp for low constant
000A04 6E24           01073         movwf       tempL_EE
                      01074         
000A06 6A16           01075         clrf        counter2
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 30


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

000A08 6A15           01076         clrf        counter
                      01077         
000A0A                01078 ShiftLoop
000A0A 2A15           01079         incf            counter
                      01080         READEE          REG_EE, H_EE, L_EE
000A0C C020 FFAA          M         movff   H_EE, EEADRH        ; read to high
000A10 C021 FFA9          M         movff   L_EE, EEADR         ; read to low
000A14 9EA6               M         bcf     EECON1, EEPGD       ; point to data memory
000A16 9CA6               M         bcf     EECON1, CFGS        ; access to EEPROM
000A18 80A6               M         bsf     EECON1, RD          ; read EEPROM
000A1A CFA8 F022          M         movff   EEDATA, REG_EE      ; put data into file
000A1E 0E15           01081         movlw           d'21'
000A20 2621           01082         addwf           L_EE
                      01083         WriteEE         REG_EE, H_EE, L_EE
000A22 C020 FFAA          M         movff   H_EE, EEADRH        ; High address
000A26 C021 FFA9          M         movff   L_EE, EEADR         ; Low address
000A2A C022 FFA8          M         movff   REG_EE, EEDATA      ; set word
                          M 
000A2E B2A6               M         btfsc   EECON1, WR          ; test if WR=0, skip if so
000A30 D???               M         bra     $-2
                          M 
000A32 9EA6               M         bcf     EECON1, EEPGD       ; Point to data memory
000A34 9CA6               M         bcf     EECON1, CFGS        ; Access EEPROM
000A36 84A6               M         bsf     EECON1, WREN        ; enable write
000A38 9EF2               M         bcf     INTCON, GIE         ; disable interrupts during write
000A3A 98A1               M         bcf     PIR2, EEIF
                          M 
000A3C 0E55               M         movlw   0x55
000A3E 6EA7               M         movwf   EECON2              ; write 55h
000A40 0EAA               M         movlw   0xaa
000A42 6EA7               M         movwf   EECON2              ; write 0xaa
000A44 82A6               M         bsf     EECON1, WR          ; begin write
000A46 B2A6               M         btfsc   EECON1, WR
000A48 D???               M         bra     $-2
                          M 
000A4A 8EF2               M         bsf     INTCON, GIE         ; enable interrupts after write
000A4C 94A6               M         bcf     EECON1, WREN        ; disable writes
000A4E 0E14           01084         movlw           d'20'
000A50 5E21           01085         subwf           L_EE
000A52 0E15           01086         movlw           d'21'
000A54 6215           01087         cpfseq          counter
000A56 EF?? F???      01088         goto            ShiftLoop
                      01089         
                      01090         ; Set EEPROM address to the previous 21 byte block, and reset temp address
000A5A 0E2A           01091         movlw           d'42'
000A5C 5E21           01092         subwf           L_EE
000A5E 0EDC           01093         movlw           d'220'
000A60 6E24           01094         movwf           tempL_EE
000A62 6A15           01095         clrf            counter
000A64 2A16           01096         incf            counter2
000A66 0E09           01097         movlw           d'9'
000A68 6216           01098         cpfseq          counter2        ; Skip if 9 shifts were made
000A6A EF?? F???      01099         goto            ShiftLoop
                      01100 
000A6E 0012           01101         return
                      01102         
000A70                01103 RTC_INIT
                      01104         ; set sda and scl to high
000A70 9882           01105         bcf     PORTC, 4
000A72 9682           01106         bcf     PORTC, 3
000A74 8894           01107         bsf     TRISC, 4
000A76 8694           01108         bsf     TRISC, 3
                      01109         
000A78 EC?? F???      01110         call    INIT_RTC
                      01111         
                      01112         ;call   SET_TIME
Warning[203]: Found opcode in column 1. (return)
000A7C 0012           01113 return
                      01114         
000A7E                01115 SAVE_TIME
                      01116         rtc_read    0x02        ; hours     ; need to call this twice idk y
000A7E 0E02               M     movlw   0x02
000A80 6E??               M     movwf   regaddress
000A82 EC?? F???          M     call    read_rtc
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 31


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

000A86 C??? FFE8          M     movff   datachar, WREG
000A8A EC?? F???          M     call    rtc_convert
                      01117         rtc_read    0x02        ; hours
000A8E 0E02               M     movlw   0x02
000A90 6E??               M     movwf   regaddress
000A92 EC?? F???          M     call    read_rtc
000A96 C??? FFE8          M     movff   datachar, WREG
000A9A EC?? F???          M     call    rtc_convert
000A9E EC?? F???      01118         call    WriteEE_RTC
                      01119         rtc_read    0x01        ; minutes
000AA2 0E01               M     movlw   0x01
000AA4 6E??               M     movwf   regaddress
000AA6 EC?? F???          M     call    read_rtc
000AAA C??? FFE8          M     movff   datachar, WREG
000AAE EC?? F???          M     call    rtc_convert
000AB2 EC?? F???      01120         call    WriteEE_RTC
                      01121         rtc_read    0x06        ; years
000AB6 0E06               M     movlw   0x06
000AB8 6E??               M     movwf   regaddress
000ABA EC?? F???          M     call    read_rtc
000ABE C??? FFE8          M     movff   datachar, WREG
000AC2 EC?? F???          M     call    rtc_convert
000AC6 EC?? F???      01122         call    WriteEE_RTC
                      01123         rtc_read    0x05        ; months
000ACA 0E05               M     movlw   0x05
000ACC 6E??               M     movwf   regaddress
000ACE EC?? F???          M     call    read_rtc
000AD2 C??? FFE8          M     movff   datachar, WREG
000AD6 EC?? F???          M     call    rtc_convert
000ADA EC?? F???      01124         call    WriteEE_RTC
                      01125         rtc_read    0x04        ; days
000ADE 0E04               M     movlw   0x04
000AE0 6E??               M     movwf   regaddress
000AE2 EC?? F???          M     call    read_rtc
000AE6 C??? FFE8          M     movff   datachar, WREG
000AEA EC?? F???          M     call    rtc_convert
000AEE EC?? F???      01126         call    WriteEE_RTC
Warning[203]: Found opcode in column 1. (return)
000AF2 0012           01127 return
                      01128         
000AF4                01129 SAVE_EXE_TIME
                      01130         
Warning[202]: Argument out of range.  Least significant bits used.
000AF4 3818           01131         swapf   OP_sec, WREG    ; 100's seconds
000AF6 6E17           01132         movwf   temp
000AF8 0E0F           01133         movlw   0x0f
000AFA 1617           01134         andwf   temp
000AFC C017 FFE8      01135         movff   temp, WREG
000B00 0F30           01136         addlw   0x30    
                      01137         WriteEE WREG, H_EE, L_EE
000B02 C020 FFAA          M         movff   H_EE, EEADRH        ; High address
000B06 C021 FFA9          M         movff   L_EE, EEADR         ; Low address
000B0A CFE8 FFA8          M         movff   WREG, EEDATA        ; set word
                          M 
000B0E B2A6               M         btfsc   EECON1, WR          ; test if WR=0, skip if so
000B10 D???               M         bra     $-2
                          M 
000B12 9EA6               M         bcf     EECON1, EEPGD       ; Point to data memory
000B14 9CA6               M         bcf     EECON1, CFGS        ; Access EEPROM
000B16 84A6               M         bsf     EECON1, WREN        ; enable write
000B18 9EF2               M         bcf     INTCON, GIE         ; disable interrupts during write
000B1A 98A1               M         bcf     PIR2, EEIF
                          M 
000B1C 0E55               M         movlw   0x55
000B1E 6EA7               M         movwf   EECON2              ; write 55h
000B20 0EAA               M         movlw   0xaa
000B22 6EA7               M         movwf   EECON2              ; write 0xaa
000B24 82A6               M         bsf     EECON1, WR          ; begin write
000B26 B2A6               M         btfsc   EECON1, WR
000B28 D???               M         bra     $-2
                          M 
000B2A 8EF2               M         bsf     INTCON, GIE         ; enable interrupts after write
000B2C 94A6               M         bcf     EECON1, WREN        ; disable writes
000B2E 2A21           01138         incf    L_EE
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 32


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01139         
000B30 C018 F017      01140         movff   OP_sec, temp    ; 10's seconds
000B34 0E0F           01141         movlw   0x0f
000B36 1617           01142         andwf   temp            ; Temp = lower nibble of Op_sec
000B38 C017 FFE8      01143         movff   temp, WREG      ; W = Temp
000B3C 0F30           01144         addlw   0x30            ; Convert to ASCII
                      01145         WriteEE WREG, H_EE, L_EE
000B3E C020 FFAA          M         movff   H_EE, EEADRH        ; High address
000B42 C021 FFA9          M         movff   L_EE, EEADR         ; Low address
000B46 CFE8 FFA8          M         movff   WREG, EEDATA        ; set word
                          M 
000B4A B2A6               M         btfsc   EECON1, WR          ; test if WR=0, skip if so
000B4C D???               M         bra     $-2
                          M 
000B4E 9EA6               M         bcf     EECON1, EEPGD       ; Point to data memory
000B50 9CA6               M         bcf     EECON1, CFGS        ; Access EEPROM
000B52 84A6               M         bsf     EECON1, WREN        ; enable write
000B54 9EF2               M         bcf     INTCON, GIE         ; disable interrupts during write
000B56 98A1               M         bcf     PIR2, EEIF
                          M 
000B58 0E55               M         movlw   0x55
000B5A 6EA7               M         movwf   EECON2              ; write 55h
000B5C 0EAA               M         movlw   0xaa
000B5E 6EA7               M         movwf   EECON2              ; write 0xaa
000B60 82A6               M         bsf     EECON1, WR          ; begin write
000B62 B2A6               M         btfsc   EECON1, WR
000B64 D???               M         bra     $-2
                          M 
000B66 8EF2               M         bsf     INTCON, GIE         ; enable interrupts after write
000B68 94A6               M         bcf     EECON1, WREN        ; disable writes
000B6A 2A21           01146         incf    L_EE
                      01147         
Warning[202]: Argument out of range.  Least significant bits used.
000B6C 3819           01148         swapf   OP_INT, WREG    ;1's seconds
000B6E 6E17           01149         movwf   temp
000B70 0E0F           01150         movlw   0x0f
000B72 1617           01151         andwf   temp
000B74 C017 FFE8      01152         movff   temp, WREG
000B78 0F30           01153         addlw   0x30
                      01154         WriteEE WREG, H_EE, L_EE
000B7A C020 FFAA          M         movff   H_EE, EEADRH        ; High address
000B7E C021 FFA9          M         movff   L_EE, EEADR         ; Low address
000B82 CFE8 FFA8          M         movff   WREG, EEDATA        ; set word
                          M 
000B86 B2A6               M         btfsc   EECON1, WR          ; test if WR=0, skip if so
000B88 D???               M         bra     $-2
                          M 
000B8A 9EA6               M         bcf     EECON1, EEPGD       ; Point to data memory
000B8C 9CA6               M         bcf     EECON1, CFGS        ; Access EEPROM
000B8E 84A6               M         bsf     EECON1, WREN        ; enable write
000B90 9EF2               M         bcf     INTCON, GIE         ; disable interrupts during write
000B92 98A1               M         bcf     PIR2, EEIF
                          M 
000B94 0E55               M         movlw   0x55
000B96 6EA7               M         movwf   EECON2              ; write 55h
000B98 0EAA               M         movlw   0xaa
000B9A 6EA7               M         movwf   EECON2              ; write 0xaa
000B9C 82A6               M         bsf     EECON1, WR          ; begin write
000B9E B2A6               M         btfsc   EECON1, WR
000BA0 D???               M         bra     $-2
                          M 
000BA2 8EF2               M         bsf     INTCON, GIE         ; enable interrupts after write
000BA4 94A6               M         bcf     EECON1, WREN        ; disable writes
000BA6 2A21           01155         incf    L_EE
Warning[203]: Found opcode in column 1. (return)
000BA8 0012           01156 return
                      01157         
                      01158                 
000BAA                01159 DISPLAY_RTC
                      01160         ; display data in this format hh/minmin/yy yy/mm/dd
                      01161         
                      01162         rtc_read    0x02            ; 0x02 from DS1307 - hours
000BAA 0E02               M     movlw   0x02
000BAC 6E??               M     movwf   regaddress
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 33


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

000BAE EC?? F???          M     call    read_rtc
000BB2 C??? FFE8          M     movff   datachar, WREG
000BB6 EC?? F???          M     call    rtc_convert
000BBA C??? FFE8      01163         movff   tens_digit,WREG
000BBE EC?? F???      01164         call    WR_DATA
000BC2 C??? FFE8      01165         movff   ones_digit,WREG
000BC6 EC?? F???      01166         call    WR_DATA
000BCA 0E68           01167         movlw   "h"
000BCC EC?? F???      01168         call    WR_DATA
                      01169         
                      01170         rtc_read    0x01            ; 0x01 from DS1307 - minutes
000BD0 0E01               M     movlw   0x01
000BD2 6E??               M     movwf   regaddress
000BD4 EC?? F???          M     call    read_rtc
000BD8 C??? FFE8          M     movff   datachar, WREG
000BDC EC?? F???          M     call    rtc_convert
000BE0 C??? FFE8      01171         movff   tens_digit,WREG
000BE4 EC?? F???      01172         call    WR_DATA
000BE8 C??? FFE8      01173         movff   ones_digit,WREG
000BEC EC?? F???      01174         call    WR_DATA
                      01175         
                      01176         rtc_read    0x00            ; 0x00 from DS1307 - seconds
000BF0 0E00               M     movlw   0x00
000BF2 6E??               M     movwf   regaddress
000BF4 EC?? F???          M     call    read_rtc
000BF8 C??? FFE8          M     movff   datachar, WREG
000BFC EC?? F???          M     call    rtc_convert
000C00 C??? FFE8      01177         movff   tens_digit,WREG
000C04 EC?? F???      01178         call    WR_DATA
000C08 C??? FFE8      01179         movff   ones_digit,WREG
000C0C EC?? F???      01180         call    WR_DATA
000C10 0E20           01181         movlw   " "
000C12 EC?? F???      01182         call    WR_DATA
                      01183         
                      01184         rtc_read    0x06            ; 0x06 from DS1307 - years
000C16 0E06               M     movlw   0x06
000C18 6E??               M     movwf   regaddress
000C1A EC?? F???          M     call    read_rtc
000C1E C??? FFE8          M     movff   datachar, WREG
000C22 EC?? F???          M     call    rtc_convert
000C26 C??? FFE8      01185         movff   tens_digit,WREG
000C2A EC?? F???      01186         call    WR_DATA
000C2E C??? FFE8      01187         movff   ones_digit,WREG
000C32 EC?? F???      01188         call    WR_DATA
000C36 0E2F           01189         movlw   "/"
000C38 EC?? F???      01190         call    WR_DATA
                      01191         
                      01192         rtc_read    0x05            ; 0x05 from DS1307 - months
000C3C 0E05               M     movlw   0x05
000C3E 6E??               M     movwf   regaddress
000C40 EC?? F???          M     call    read_rtc
000C44 C??? FFE8          M     movff   datachar, WREG
000C48 EC?? F???          M     call    rtc_convert
000C4C C??? FFE8      01193         movff   tens_digit,WREG
000C50 EC?? F???      01194         call    WR_DATA
000C54 C??? FFE8      01195         movff   ones_digit,WREG
000C58 EC?? F???      01196         call    WR_DATA
000C5C 0E2F           01197         movlw   "/"
000C5E EC?? F???      01198         call    WR_DATA
                      01199         
                      01200         rtc_read    0x04            ; 0x04 from DS1307 - days
000C62 0E04               M     movlw   0x04
000C64 6E??               M     movwf   regaddress
000C66 EC?? F???          M     call    read_rtc
000C6A C??? FFE8          M     movff   datachar, WREG
000C6E EC?? F???          M     call    rtc_convert
000C72 C??? FFE8      01201         movff   tens_digit,WREG
000C76 EC?? F???      01202         call    WR_DATA
000C7A C??? FFE8      01203         movff   ones_digit,WREG
000C7E EC?? F???      01204         call    WR_DATA
Warning[203]: Found opcode in column 1. (return)
000C82 0012           01205 return
                      01206         
000C84                01207 SET_TIME
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 34


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

                      01208         rtc_resetAll
                          M 
000C84 6A??               M     clrf    databyte
000C86 0E06               M     movlw   6
000C88 6E??               M     movwf   regaddress ;start at 6 and go down, and set all to 0
                          M 
Warning[207]: Found label after column 1. (del_loop0)
000C8A                    M     del_loop0
000C8A EC?? F???          M     call    write_rtc
000C8E 2E??               M     decfsz  regaddress
000C90 D???               M     bra     del_loop0
000C92 EC?? F???          M     call    write_rtc ;sets registers 0-6 to zero
Warning[207]: Found label after column 1. (_loopknt)
  00000001                M     _loopknt set _loopknt+1
                      01209         
                      01210         rtc_set 0x00,   b'10000000'
000C96 0E00               M     movlw   0x00
000C98 6E??               M     movwf   regaddress
000C9A 0E80               M     movlw   b'10000000'
000C9C 6E??               M     movwf   databyte
000C9E EC?? F???          M     call    write_rtc
                      01211 
                      01212         rtc_set 0x06,   b'00010111'             ; Year 17
000CA2 0E06               M     movlw   0x06
000CA4 6E??               M     movwf   regaddress
000CA6 0E17               M     movlw   b'00010111'
000CA8 6E??               M     movwf   databyte
000CAA EC?? F???          M     call    write_rtc
                      01213         rtc_set 0x05,   b'00000011'             ; Month 03
000CAE 0E05               M     movlw   0x05
000CB0 6E??               M     movwf   regaddress
000CB2 0E03               M     movlw   b'00000011'
000CB4 6E??               M     movwf   databyte
000CB6 EC?? F???          M     call    write_rtc
                      01214         rtc_set 0x04,   b'00000100'             ; Date 04
000CBA 0E04               M     movlw   0x04
000CBC 6E??               M     movwf   regaddress
000CBE 0E04               M     movlw   b'00000100'
000CC0 6E??               M     movwf   databyte
000CC2 EC?? F???          M     call    write_rtc
                      01215         rtc_set 0x02,   b'00010010'             ; Hours 12
000CC6 0E02               M     movlw   0x02
000CC8 6E??               M     movwf   regaddress
000CCA 0E12               M     movlw   b'00010010'
000CCC 6E??               M     movwf   databyte
000CCE EC?? F???          M     call    write_rtc
                      01216         rtc_set 0x01,   b'01001000'             ; Minutes 27
000CD2 0E01               M     movlw   0x01
000CD4 6E??               M     movwf   regaddress
000CD6 0E48               M     movlw   b'01001000'
000CD8 6E??               M     movwf   databyte
000CDA EC?? F???          M     call    write_rtc
                      01217         rtc_set 0x00,   b'00000000'             ; Seconds 0
000CDE 0E00               M     movlw   0x00
000CE0 6E??               M     movwf   regaddress
000CE2 0E00               M     movlw   b'00000000'
000CE4 6E??               M     movwf   databyte
000CE6 EC?? F???          M     call    write_rtc
Warning[203]: Found opcode in column 1. (return)
000CEA 0012           01218 return
                      01219         
000CEC                01220 INIT_USART
                      01221         
000CEC 8E94           01222         bsf     TRISC, 7        ; set RC7=USART RC
000CEE 9C94           01223         bcf     TRISC, 6        ; clear RC6=USART TX
                      01224 
000CF0 0E0F           01225         movlw   15              ; baud rate 9600
000CF2 6EAF           01226         movwf   SPBRG
000CF4 6AAC           01227         clrf    TXSTA
                      01228         
000CF6 6AAB           01229         clrf    RCSTA
000CF8 8EAB           01230         bsf     RCSTA,SPEN      ; asynchronous serial port enable
000CFA 88AB           01231         bsf     RCSTA,CREN      ; continous receive
                      01232         
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 35


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

000CFC 8AAC           01233         bsf     TXSTA, TXEN     ; transmit enabled
000CFE 0012           01234         return
                      01235 
000D00                01236 DataUSART
000D00 0E02           01237         movlw   0x02
000D02 EC?? F???      01238         call    USART_WAIT
000D06 0E0D           01239         movlw   0x0D
000D08 EC?? F???      01240         call    USART_WAIT
                      01241         
000D0C 6A15           01242         clrf    counter         ; used to cycle through past 9 eeprom logs
000D0E 6A16           01243         clrf    counter2        ; used to transmit all 18 bits of saved data
                      01244         
000D10                01245 TRANSFER_LOGS
000D10 0E15           01246         movlw   d'21'           ; logs are 21 bits apart
000D12 0215           01247         mulwf   counter         ; log number one starts at eeprom address 0
000D14 CFF3 F021      01248         movff   PRODL, L_EE     ; low address now points to count X 21
000D18 6A16           01249         clrf    counter2
                      01250         
000D1A                01251 TRANSFER_DATA   
                      01252         READEE  WREG, H_EE, L_EE
000D1A C020 FFAA          M         movff   H_EE, EEADRH        ; read to high
000D1E C021 FFA9          M         movff   L_EE, EEADR         ; read to low
000D22 9EA6               M         bcf     EECON1, EEPGD       ; point to data memory
000D24 9CA6               M         bcf     EECON1, CFGS        ; access to EEPROM
000D26 80A6               M         bsf     EECON1, RD          ; read EEPROM
000D28 CFA8 FFE8          M         movff   EEDATA, WREG        ; put data into file
000D2C EC?? F???      01253         call    USART_WAIT      ; transfer bit
000D30 2A21           01254         incf    L_EE
                      01255         
000D32 2A16           01256         incf    counter2
000D34 0E12           01257         movlw   d'18'           ; each perm log has 18 bits of saved data, so 
000D36 6216           01258         cpfseq  counter2        ; see if we're at 18. if so, we're done reading
000D38 D???           01259         bra TRANSFER_DATA       ; this permanent log and onto next.
                      01260         
000D3A EC?? F???      01261         call    USART_LINE      ; new line because a e s t h e t i c
                      01262         
000D3E 2A15           01263         incf    counter
000D40 0E08           01264         movlw   d'8'            ; we save up to the last 9 permanent logs
000D42 6215           01265         cpfseq  counter
000D44 D???           01266         bra     TRANSFER_LOGS
                      01267         
000D46 EC?? F???      01268         call    LCD_L2
                      01269         Display PCComplete
  0000                    M         local   loop
000D4A 0E??               M         movlw   upper PCComplete ; Move Table<20:16>
000D4C 6EF8               M         movwf   TBLPTRU
000D4E 0E??               M         movlw   high PCComplete ; Move Table<15:8>
000D50 6EF7               M         movwf   TBLPTRH
000D52 0E??               M         movlw   low PCComplete  ; Move Table<7:0>
000D54 6EF6               M         movwf   TBLPTRL
000D56 0008               M         tblrd*                  ; Read byte from TBLPTRL to TABLAT
000D58 50F5               M         movf    TABLAT, W
000D5A                    M loop
000D5A EC?? F???          M         call    WR_DATA         ; write to LCD
000D5E 000B               M         tblrd+*                 ; next row in table
000D60 50F5               M         movf    TABLAT, W
000D62 E1??               M         bnz     loop
                      01270         Delay50N delayR, 0x28   
  0000                    M         local   loop
000D64 0E28               M         movlw   0x28
000D66 6E1A               M         movwf   delayR
                          M 
000D68                    M loop
000D68 EC?? F???          M         call    Delay50ms
000D6C 2E1A               M         decfsz  delayR
000D6E EF?? F???          M         goto    loop
000D72 0012           01271         return                  ; done transmitting data
                      01272         
000D74                01273 USART_WAIT
000D74 6EAD           01274         movwf   TXREG
000D76 A2AC           01275         btfss   TXSTA, 1
000D78 EF?? F???      01276         goto    $-2
000D7C 0012           01277         return
                      01278 
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 36


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

000D7E                01279 USART_LINE
000D7E 0E0A           01280         movlw   0x0A
000D80 EC?? F???      01281         call    USART_WAIT
000D84 0E0D           01282         movlw   0x0D
000D86 EC?? F???      01283         call    USART_WAIT
000D8A 0012           01284         return
                      01285         
000D8C                01286 Delay5us
000D8C 0E78           01287         movlw   d'120'
000D8E 6E1B           01288         movwf   d5us
                      01289 
000D90                01290 loop5us
000D90 2E1B           01291         decfsz  d5us
000D92 EF?? F???      01292         goto    loop5us
000D96 0000           01293         nop
000D98 0012           01294         return
                      01295 
000D9A                01296 Delay200us
000D9A 0EA4           01297         movlw   0xA4
000D9C 6E1C           01298         movwf   d200us
                      01299 
000D9E                01300 loop200us
000D9E 2E1C           01301         decfsz  d200us
000DA0 EF?? F???      01302         goto    loop200us
000DA4 0000           01303         nop
000DA6 0012           01304         return
                      01305 
000DA8                01306 Delay50ms
000DA8 0EF9           01307         movlw   0xF9
000DAA 6E1D           01308         movwf   d50ms
                      01309 
000DAC                01310 loop50ms
000DAC EC?? F???      01311         call    Delay200us
000DB0 2E1D           01312         decfsz  d50ms
                      01313 
000DB2                01314 Cycles
000DB2 EF?? F???      01315         goto    loop50ms
000DB6 EC?? F???      01316         call    Delay200us
000DBA 0012           01317         return
                      01318 
000DBC                01319 WriteEE_RTC
                      01320         WriteEE tens_digit, H_EE, L_EE
000DBC C020 FFAA          M         movff   H_EE, EEADRH        ; High address
000DC0 C021 FFA9          M         movff   L_EE, EEADR         ; Low address
000DC4 C??? FFA8          M         movff   tens_digit, EEDATA  ; set word
                          M 
000DC8 B2A6               M         btfsc   EECON1, WR          ; test if WR=0, skip if so
000DCA D???               M         bra     $-2
                          M 
000DCC 9EA6               M         bcf     EECON1, EEPGD       ; Point to data memory
000DCE 9CA6               M         bcf     EECON1, CFGS        ; Access EEPROM
000DD0 84A6               M         bsf     EECON1, WREN        ; enable write
000DD2 9EF2               M         bcf     INTCON, GIE         ; disable interrupts during write
000DD4 98A1               M         bcf     PIR2, EEIF
                          M 
000DD6 0E55               M         movlw   0x55
000DD8 6EA7               M         movwf   EECON2              ; write 55h
000DDA 0EAA               M         movlw   0xaa
000DDC 6EA7               M         movwf   EECON2              ; write 0xaa
000DDE 82A6               M         bsf     EECON1, WR          ; begin write
000DE0 B2A6               M         btfsc   EECON1, WR
000DE2 D???               M         bra     $-2
                          M 
000DE4 8EF2               M         bsf     INTCON, GIE         ; enable interrupts after write
000DE6 94A6               M         bcf     EECON1, WREN        ; disable writes
000DE8 2A21           01321         incf    L_EE
                      01322         WriteEE ones_digit, H_EE, L_EE
000DEA C020 FFAA          M         movff   H_EE, EEADRH        ; High address
000DEE C021 FFA9          M         movff   L_EE, EEADR         ; Low address
000DF2 C??? FFA8          M         movff   ones_digit, EEDATA  ; set word
                          M 
000DF6 B2A6               M         btfsc   EECON1, WR          ; test if WR=0, skip if so
000DF8 D???               M         bra     $-2
                          M 
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 37


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

000DFA 9EA6               M         bcf     EECON1, EEPGD       ; Point to data memory
000DFC 9CA6               M         bcf     EECON1, CFGS        ; Access EEPROM
000DFE 84A6               M         bsf     EECON1, WREN        ; enable write
000E00 9EF2               M         bcf     INTCON, GIE         ; disable interrupts during write
000E02 98A1               M         bcf     PIR2, EEIF
                          M 
000E04 0E55               M         movlw   0x55
000E06 6EA7               M         movwf   EECON2              ; write 55h
000E08 0EAA               M         movlw   0xaa
000E0A 6EA7               M         movwf   EECON2              ; write 0xaa
000E0C 82A6               M         bsf     EECON1, WR          ; begin write
000E0E B2A6               M         btfsc   EECON1, WR
000E10 D???               M         bra     $-2
                          M 
000E12 8EF2               M         bsf     INTCON, GIE         ; enable interrupts after write
000E14 94A6               M         bcf     EECON1, WREN        ; disable writes
000E16 2A21           01323         incf    L_EE
000E18 0012           01324         return
                      01325 
000E1A                01326 ClearEEPROM_21
000E1A 6A20           01327         clrf    H_EE
000E1C 6A21           01328         clrf    L_EE
000E1E 681F           01329         setf    clear_EE
000E20 6A15           01330         clrf    counter
000E22                01331 ClearNext
                      01332         WriteEE         clear_EE, H_EE, L_EE
000E22 C020 FFAA          M         movff   H_EE, EEADRH        ; High address
000E26 C021 FFA9          M         movff   L_EE, EEADR         ; Low address
000E2A C01F FFA8          M         movff   clear_EE, EEDATA    ; set word
                          M 
000E2E B2A6               M         btfsc   EECON1, WR          ; test if WR=0, skip if so
000E30 D???               M         bra     $-2
                          M 
000E32 9EA6               M         bcf     EECON1, EEPGD       ; Point to data memory
000E34 9CA6               M         bcf     EECON1, CFGS        ; Access EEPROM
000E36 84A6               M         bsf     EECON1, WREN        ; enable write
000E38 9EF2               M         bcf     INTCON, GIE         ; disable interrupts during write
000E3A 98A1               M         bcf     PIR2, EEIF
                          M 
000E3C 0E55               M         movlw   0x55
000E3E 6EA7               M         movwf   EECON2              ; write 55h
000E40 0EAA               M         movlw   0xaa
000E42 6EA7               M         movwf   EECON2              ; write 0xaa
000E44 82A6               M         bsf     EECON1, WR          ; begin write
000E46 B2A6               M         btfsc   EECON1, WR
000E48 D???               M         bra     $-2
                          M 
000E4A 8EF2               M         bsf     INTCON, GIE         ; enable interrupts after write
000E4C 94A6               M         bcf     EECON1, WREN        ; disable writes
000E4E 2A15           01333         incf            counter
000E50 2A21           01334         incf            L_EE
000E52 0E15           01335         movlw           d'21'
000E54 6215           01336         cpfseq          counter
000E56 EF?? F???      01337         goto            ClearNext
000E5A 6A20           01338         clrf            H_EE
000E5C 6A21           01339         clrf            L_EE
000E5E 0012           01340         return
                      01341         
000E60                01342 READ_KEY
000E60 A281           01343         btfss   PORTB, 1        ; check for keypad interrupt
000E62 EF?? F???      01344         goto    READ_KEY
000E66 3881           01345         swapf   PORTB, W
000E68 0B0F           01346         andlw   0x0F
000E6A 6E10           01347         movwf   KEY
000E6C B281           01348         btfsc   PORTB, 1
000E6E EF?? F???      01349         goto    $-2
000E72 0012           01350         return
                      01351 
000E74                01352 READ_KEY_TIME
000E74 EC?? F???      01353         call        LCD_L2          ; go to second line to print RTC    
                      01354         ; display the time
                      01355         ; call      DISPLAY_RTC 
                      01356 
000E78 A281           01357         btfss       PORTB, 1    ; keypad interrupt
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 38


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

000E7A EF?? F???      01358         goto        READ_KEY_TIME
000E7E 3881           01359         swapf       PORTB, W    ; copy PORTB7:4 to W3:0
000E80 0B0F           01360         andlw       0x0F        ; only want W3:0
000E82 6E10           01361         movwf       KEY         ; write this value to the KEY
000E84 B281           01362         btfsc       PORTB, 1    ; wait for release
000E86 EF?? F???      01363         goto        $-2         ; go back one instruction
000E8A 0012           01364         return
                      01365 
000E8C                01366 DisplayExeTime
                      01367         READEE  REG_EE, H_EE, L_EE
000E8C C020 FFAA          M         movff   H_EE, EEADRH        ; read to high
000E90 C021 FFA9          M         movff   L_EE, EEADR         ; read to low
000E94 9EA6               M         bcf     EECON1, EEPGD       ; point to data memory
000E96 9CA6               M         bcf     EECON1, CFGS        ; access to EEPROM
000E98 80A6               M         bsf     EECON1, RD          ; read EEPROM
000E9A CFA8 F022          M         movff   EEDATA, REG_EE      ; put data into file
000E9E 0EFF           01368         movlw   0xFF
000EA0 6222           01369         cpfseq  REG_EE
000EA2 EF?? F???      01370         goto    NoSkipDispExeTime
                      01371         Display NoData
  0000                    M         local   loop
000EA6 0E??               M         movlw   upper NoData    ; Move Table<20:16>
000EA8 6EF8               M         movwf   TBLPTRU
000EAA 0E??               M         movlw   high NoData     ; Move Table<15:8>
000EAC 6EF7               M         movwf   TBLPTRH
000EAE 0E??               M         movlw   low NoData      ; Move Table<7:0>
000EB0 6EF6               M         movwf   TBLPTRL
000EB2 0008               M         tblrd*                  ; Read byte from TBLPTRL to TABLAT
000EB4 50F5               M         movf    TABLAT, W
000EB6                    M loop
000EB6 EC?? F???          M         call    WR_DATA         ; write to LCD
000EBA 000B               M         tblrd+*                 ; next row in table
000EBC 50F5               M         movf    TABLAT, W
000EBE E1??               M         bnz     loop
000EC0 0EFF           01372         movlw   0xFF
000EC2 6022           01373         cpfslt  REG_EE
000EC4 EF?? F???      01374         goto    SkipDispExeTime
000EC8 0012           01375         return
                      01376 
000ECA                01377 NoSkipDispExeTime
                      01378         READEE  WREG, H_EE, L_EE
000ECA C020 FFAA          M         movff   H_EE, EEADRH        ; read to high
000ECE C021 FFA9          M         movff   L_EE, EEADR         ; read to low
000ED2 9EA6               M         bcf     EECON1, EEPGD       ; point to data memory
000ED4 9CA6               M         bcf     EECON1, CFGS        ; access to EEPROM
000ED6 80A6               M         bsf     EECON1, RD          ; read EEPROM
000ED8 CFA8 FFE8          M         movff   EEDATA, WREG        ; put data into file
000EDC EC?? F???      01379         call    WR_DATA
000EE0 2A21           01380         incf    L_EE
                      01381         
                      01382         READEE  WREG, H_EE, L_EE
000EE2 C020 FFAA          M         movff   H_EE, EEADRH        ; read to high
000EE6 C021 FFA9          M         movff   L_EE, EEADR         ; read to low
000EEA 9EA6               M         bcf     EECON1, EEPGD       ; point to data memory
000EEC 9CA6               M         bcf     EECON1, CFGS        ; access to EEPROM
000EEE 80A6               M         bsf     EECON1, RD          ; read EEPROM
000EF0 CFA8 FFE8          M         movff   EEDATA, WREG        ; put data into file
000EF4 EC?? F???      01383         call    WR_DATA
000EF8 2A21           01384         incf    L_EE
                      01385         
                      01386         READEE  WREG, H_EE, L_EE
000EFA C020 FFAA          M         movff   H_EE, EEADRH        ; read to high
000EFE C021 FFA9          M         movff   L_EE, EEADR         ; read to low
000F02 9EA6               M         bcf     EECON1, EEPGD       ; point to data memory
000F04 9CA6               M         bcf     EECON1, CFGS        ; access to EEPROM
000F06 80A6               M         bsf     EECON1, RD          ; read EEPROM
000F08 CFA8 FFE8          M         movff   EEDATA, WREG        ; put data into file
000F0C EC?? F???      01387         call    WR_DATA
000F10 2A21           01388         incf    L_EE
                      01389 
000F12 0E73           01390         movlw   0x73            ; Write 's'
000F14 EC?? F???      01391         call    WR_DATA
000F18 EC?? F???      01392         call    LCD_L2
000F1C                01393 SkipDispExeTime
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 39


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

000F1C 0012           01394         return
                      01395 
000F1E                01396 DispOpSort
                      01397         READEE  REG_EE, H_EE, L_EE
000F1E C020 FFAA          M         movff   H_EE, EEADRH        ; read to high
000F22 C021 FFA9          M         movff   L_EE, EEADR         ; read to low
000F26 9EA6               M         bcf     EECON1, EEPGD       ; point to data memory
000F28 9CA6               M         bcf     EECON1, CFGS        ; access to EEPROM
000F2A 80A6               M         bsf     EECON1, RD          ; read EEPROM
000F2C CFA8 F022          M         movff   EEDATA, REG_EE      ; put data into file
000F30 0EFF           01398         movlw   0xff
000F32 6222           01399         cpfseq  REG_EE
000F34 EF?? F???      01400         goto    NoSkipDispOpSort
                      01401         Display NoData
  0000                    M         local   loop
000F38 0E??               M         movlw   upper NoData    ; Move Table<20:16>
000F3A 6EF8               M         movwf   TBLPTRU
000F3C 0E??               M         movlw   high NoData     ; Move Table<15:8>
000F3E 6EF7               M         movwf   TBLPTRH
000F40 0E??               M         movlw   low NoData      ; Move Table<7:0>
000F42 6EF6               M         movwf   TBLPTRL
000F44 0008               M         tblrd*                  ; Read byte from TBLPTRL to TABLAT
000F46 50F5               M         movf    TABLAT, W
000F48                    M loop
000F48 EC?? F???          M         call    WR_DATA         ; write to LCD
000F4C 000B               M         tblrd+*                 ; next row in table
000F4E 50F5               M         movf    TABLAT, W
000F50 E1??               M         bnz     loop
000F52 0EFF           01402         movlw   0xff
000F54 6022           01403         cpfslt  REG_EE
000F56 EF?? F???      01404         goto    SkipDispOpSort
                      01405 
000F5A                01406 NoSkipDispOpSort
000F5A 0E61           01407         movlw   "a"
000F5C EC?? F???      01408         call    WR_DATA
                      01409         
                      01410         READEE  REG_EE, H_EE, L_EE
000F60 C020 FFAA          M         movff   H_EE, EEADRH        ; read to high
000F64 C021 FFA9          M         movff   L_EE, EEADR         ; read to low
000F68 9EA6               M         bcf     EECON1, EEPGD       ; point to data memory
000F6A 9CA6               M         bcf     EECON1, CFGS        ; access to EEPROM
000F6C 80A6               M         bsf     EECON1, RD          ; read EEPROM
000F6E CFA8 F022          M         movff   EEDATA, REG_EE      ; put data into file
000F72 C022 FFE8      01411         movff   REG_EE, WREG
000F76 EC?? F???      01412         call    WR_DATA
000F7A 2A21           01413         incf    L_EE
                      01414         
000F7C 0E20           01415         movlw   " "
000F7E EC?? F???      01416         call    WR_DATA
                      01417         
000F82 0E62           01418         movlw   "b"
000F84 EC?? F???      01419         call    WR_DATA
                      01420         
                      01421         READEE  REG_EE, H_EE, L_EE
000F88 C020 FFAA          M         movff   H_EE, EEADRH        ; read to high
000F8C C021 FFA9          M         movff   L_EE, EEADR         ; read to low
000F90 9EA6               M         bcf     EECON1, EEPGD       ; point to data memory
000F92 9CA6               M         bcf     EECON1, CFGS        ; access to EEPROM
000F94 80A6               M         bsf     EECON1, RD          ; read EEPROM
000F96 CFA8 F022          M         movff   EEDATA, REG_EE      ; put data into file
000F9A C022 FFE8      01422         movff   REG_EE, WREG
000F9E EC?? F???      01423         call    WR_DATA
000FA2 2A21           01424         incf    L_EE
                      01425         
000FA4 0E20           01426         movlw   " "
000FA6 EC?? F???      01427         call    WR_DATA
                      01428         
000FAA 0E63           01429         movlw   "c"
000FAC EC?? F???      01430         call    WR_DATA
                      01431         
                      01432         READEE  REG_EE, H_EE, L_EE
000FB0 C020 FFAA          M         movff   H_EE, EEADRH        ; read to high
000FB4 C021 FFA9          M         movff   L_EE, EEADR         ; read to low
000FB8 9EA6               M         bcf     EECON1, EEPGD       ; point to data memory
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 40


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

000FBA 9CA6               M         bcf     EECON1, CFGS        ; access to EEPROM
000FBC 80A6               M         bsf     EECON1, RD          ; read EEPROM
000FBE CFA8 F022          M         movff   EEDATA, REG_EE      ; put data into file
000FC2 C022 FFE8      01433         movff   REG_EE, WREG
000FC6 EC?? F???      01434         call    WR_DATA
000FCA 2A21           01435         incf    L_EE
                      01436         
000FCC 0E20           01437         movlw   " "
000FCE EC?? F???      01438         call    WR_DATA
                      01439         
000FD2 0E64           01440         movlw   "d"
000FD4 EC?? F???      01441         call    WR_DATA
                      01442         
                      01443         READEE  REG_EE, H_EE, L_EE
000FD8 C020 FFAA          M         movff   H_EE, EEADRH        ; read to high
000FDC C021 FFA9          M         movff   L_EE, EEADR         ; read to low
000FE0 9EA6               M         bcf     EECON1, EEPGD       ; point to data memory
000FE2 9CA6               M         bcf     EECON1, CFGS        ; access to EEPROM
000FE4 80A6               M         bsf     EECON1, RD          ; read EEPROM
000FE6 CFA8 F022          M         movff   EEDATA, REG_EE      ; put data into file
000FEA C022 FFE8      01444         movff   REG_EE, WREG
000FEE EC?? F???      01445         call    WR_DATA
000FF2 2A21           01446         incf    L_EE
                      01447 
000FF4                01448 SkipDispOpSort
000FF4 0012           01449         return
                      01450         
000FF6                01451 DispOpRTC
                      01452         READEE  REG_EE, H_EE, L_EE
000FF6 C020 FFAA          M         movff   H_EE, EEADRH        ; read to high
000FFA C021 FFA9          M         movff   L_EE, EEADR         ; read to low
000FFE 9EA6               M         bcf     EECON1, EEPGD       ; point to data memory
001000 9CA6               M         bcf     EECON1, CFGS        ; access to EEPROM
001002 80A6               M         bsf     EECON1, RD          ; read EEPROM
001004 CFA8 F022          M         movff   EEDATA, REG_EE      ; put data into file
001008 0EFF           01453         movlw   0xff
00100A 6222           01454         cpfseq  REG_EE
00100C EF?? F???      01455         goto    NoSkipDispOpRTC
                      01456         Display NoData
  0000                    M         local   loop
001010 0E??               M         movlw   upper NoData    ; Move Table<20:16>
001012 6EF8               M         movwf   TBLPTRU
001014 0E??               M         movlw   high NoData     ; Move Table<15:8>
001016 6EF7               M         movwf   TBLPTRH
001018 0E??               M         movlw   low NoData      ; Move Table<7:0>
00101A 6EF6               M         movwf   TBLPTRL
00101C 0008               M         tblrd*                  ; Read byte from TBLPTRL to TABLAT
00101E 50F5               M         movf    TABLAT, W
001020                    M loop
001020 EC?? F???          M         call    WR_DATA         ; write to LCD
001024 000B               M         tblrd+*                 ; next row in table
001026 50F5               M         movf    TABLAT, W
001028 E1??               M         bnz     loop
00102A 0EFF           01457         movlw   0xff
00102C 6022           01458         cpfslt  REG_EE
00102E EF?? F???      01459         goto    SkipDispOpRTC
                      01460 
001032                01461 NoSkipDispOpRTC
                      01462         READEE  REG_EE, H_EE, L_EE
001032 C020 FFAA          M         movff   H_EE, EEADRH        ; read to high
001036 C021 FFA9          M         movff   L_EE, EEADR         ; read to low
00103A 9EA6               M         bcf     EECON1, EEPGD       ; point to data memory
00103C 9CA6               M         bcf     EECON1, CFGS        ; access to EEPROM
00103E 80A6               M         bsf     EECON1, RD          ; read EEPROM
001040 CFA8 F022          M         movff   EEDATA, REG_EE      ; put data into file
001044 C022 FFE8      01463         movff   REG_EE, WREG
001048 EC?? F???      01464         call    WR_DATA
00104C 2A21           01465         incf    L_EE
                      01466         
                      01467         READEE  REG_EE, H_EE, L_EE
00104E C020 FFAA          M         movff   H_EE, EEADRH        ; read to high
001052 C021 FFA9          M         movff   L_EE, EEADR         ; read to low
001056 9EA6               M         bcf     EECON1, EEPGD       ; point to data memory
001058 9CA6               M         bcf     EECON1, CFGS        ; access to EEPROM
MPASM 5.72  /USERS/MREITER/DESKTOP/AER201/BO   3-30-2017  22:15:28         PAGE 41


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE

00105A 80A6               M         bsf     EECON1, RD          ; read EEPROM
00105C CFA8 F022          M         movff   EEDATA, REG_EE      ; put data into file
001060 C022 FFE8      01468         movff   REG_EE, WREG
001064 EC?? F???      01469         call    WR_DATA
001068 2A21           01470         incf    L_EE
                      01471 
00106A 0E68           01472         movlw   "h"
00106C EC?? F???      01473         call    WR_DATA
                      01474         
001070 EC?? F???      01475         call    DispOpRTC_Helper
                      01476         
001074 0E20           01477         movlw   " "
001076 EC?? F???      01478         call    WR_DATA
                      01479         
00107A EC?? F???      01480         call    DispOpRTC_Helper
00107E 0E2F           01481         movlw   "/"
001080 EC?? F???      01482         call    WR_DATA
                      01483 
001084 EC?? F???      01484         call    DispOpRTC_Helper
001088 0E2F           01485         movlw   "/"
00108A EC?? F???      01486         call    WR_DATA
00108E EC?? F???      01487         call    DispOpRTC_Helper
001092                01488 SkipDispOpRTC
001092 0012           01489                 return
001094                01490 DispOpRTC_Helper
                      01491         READEE          REG_EE, H_EE, L_EE
001094 C020 FFAA          M         movff   H_EE, EEADRH        ; read to high
001098 C021 FFA9          M         movff   L_EE, EEADR         ; read to low
00109C 9EA6               M         bcf     EECON1, EEPGD       ; point to data memory
00109E 9CA6               M         bcf     EECON1, CFGS        ; access to EEPROM
0010A0 80A6               M         bsf     EECON1, RD          ; read EEPROM
0010A2 CFA8 F022          M         movff   EEDATA, REG_EE      ; put data into file
0010A6 C022 FFE8      01492         movff           REG_EE, WREG
0010AA EC?? F???      01493         call            WR_DATA
0010AE 2A21           01494         incf            L_EE
                      01495         READEE          REG_EE, H_EE, L_EE
0010B0 C020 FFAA          M         movff   H_EE, EEADRH        ; read to high
0010B4 C021 FFA9          M         movff   L_EE, EEADR         ; read to low
0010B8 9EA6               M         bcf     EECON1, EEPGD       ; point to data memory
0010BA 9CA6               M         bcf     EECON1, CFGS        ; access to EEPROM
0010BC 80A6               M         bsf     EECON1, RD          ; read EEPROM
0010BE CFA8 F022          M         movff   EEDATA, REG_EE      ; put data into file
0010C2 C022 FFE8      01496         movff           REG_EE, WREG
0010C6 EC?? F???      01497         call            WR_DATA
0010CA 2A21           01498         incf            L_EE
0010CC 0012           01499         return
Warning[205]: Found directive in column 1. (end)
                      01500 end

Errors   :     0
Warnings :    39 reported,     0 suppressed
Messages :     0 reported,     0 suppressed

